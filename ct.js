(function() {
const deadPool=[],copyTypeSymbol=Symbol("I am a ct.js copy");setInterval((function(){deadPool.length=0}),6e4);const ct={speed:60,types:{},snd:{},stack:[],fps:60,delta:1,deltaUi:1,camera:null,version:"1.6.2",meta:{name:"oneroom",author:"white",site:"",version:"0.0.0"},main:{fpstick:0,pi:0},get width(){return ct.pixiApp.renderer.view.width},set width(t){return ct.camera.width=ct.roomWidth=t,ct.fittoscreen&&"fastScale"!==ct.fittoscreen.mode||ct.pixiApp.renderer.resize(t,ct.height),ct.fittoscreen&&ct.fittoscreen(),t},get height(){return ct.pixiApp.renderer.view.height},set height(t){return ct.camera.height=ct.roomHeight=t,ct.fittoscreen&&"fastScale"!==ct.fittoscreen.mode||ct.pixiApp.renderer.resize(ct.width,t),ct.fittoscreen&&ct.fittoscreen(),t},get viewWidth(){return ct.camera.width},get viewHeight(){return ct.camera.height}};function openFrom(){window.location.replace(_link.formLink)}function getUserkey(t){if(window._ut.isLocal()||__is_test)return window._ut.makeUUID();if(0===t){const t=window._ut.getQueryHash();if(t&&t.gplay)return t.gplay;goNextLink(2)}if(1===t){const t=window._ut.getQueryHash();if(t&&t.user_key)return t.user_key;goNextLink(2)}else if(2===t){if(null!==localStorage.getItem(ct.meta.name+"_userkey"))return localStorage.getItem(ct.meta.name+"_userkey");goNextLink(2)}}window._ut={log:function(){dbg&&window.console&&window.console.log.apply(null,arguments)},elog:function(){dbg&&window.console&&window.console.error.apply(null,arguments)},clog:function(t,e="yellow",i="black"){window.console.log("%c"+t,`background: ${i}; color: ${e}`)},slog:function(t){if(!dbg)return;const e=[`%c %c %c >> [STATE] >>> [${ct.room._state}]--\x3e[${t}] %c  `,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;"];window.console.log(...e)},lpad:function(t,e){return(t+(e+="")).slice(e.length)},addComma:function(t){return Number(t).toLocaleString()},getFloatFixed:function(t,e){return parseFloat(Math.round(100*t)/100).toFixed(e)},isBetween:function(t,e,i){return t>=e&&t<=i},isBetweenPos:function(t,e){return void 0===t.x||void 0===t.y||void 0===e.x||void 0===e.y||void 0===e.w||void 0===e.h?(this.elog("[isBetweenPos] not foun pos - ",t,e),!1):!(!this.isBetween(t.x,e.x,e.x+e.w)||!this.isBetween(t.y,e.y,e.y+e.h))},shuffleArray:function(t){for(let e=t.length-1;e>0;e--){let i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}},randBetween:function(t,e){return t>=e?t:Math.floor(Math.random()*(e-t+1))+t},fillZero:function(t,e){return e.length>=t?String(e):new Array(t-String(e).length+1).join("0")+String(e)},goUrl:function(t,e){e?window.location.replace(t):window.location.href=t},getQueryHash:function(){let t=window.location.search.replace(/\?/,"").split("&"),e={};return t.map((function(t){let i=t.split("=");e[i[0]]=i[1]})),e},makeUrl:function(t,e){let i="?";for(let o in e)t+=i+o+"="+e[o],"&"!==i&&(i="&");return t},isLocal:function(){return"file:"==window.location.protocol||-1!=window.location.href.indexOf("localhost")||-1!=window.location.hostname.indexOf("localhost")},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isIos:function(){return!!navigator.userAgent.match(/iPhone|iPad/i)},fetch:function(t,e={},i){e.body&&(e.method="POST"),window.fetch(t).then((t=>t.json())).then((t=>{window._ut.log(t),i(t)})).catch((t=>{window._ut.log(t),i({code:-1,msg:t})}))},makeUUID:function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+t()+t()+t()+t()},getUUID:function(){void 0===length&&(length=24);let t=localStorage.getItem(ct.meta.name+"_userkey");return null!=t&&t.length==length||(t=makeUUID(),localStorage.setItem(ct.meta.name+"_userkey",t)),t},muted:function(t){window.Howler&&Howler.mute(t)},fetchImage:function(t,e,i){ct.res.fetchImage_removeError(e,(function(o){ct.res.registry[t]?window.console.error("registered image : "+t):o[e]&&o[e].texture?(o[e].texture.defaultAnchor={x:.5,y:.5},ct.res.registry[t]={anchor:{x:.5,y:.5},frames:1,shape:{type:"rect",top:0,bottom:o[e].texture._frame.height,left:0,right:o[e].texture._frame.width},textures:[o[e].texture]},i()):window.console.error("not found : "+t)}))},_ver:function(){dbg&&(ct.room._verLabel=new PIXI.Text(ct.meta.version,ct.styles.get("ver")),ct.room._verLabel.x=0,ct.room._verLabel.y=ct.room.height,addChild(ct.room._verLabel))}},ct.highDensity=!0;const pixiAppSettings={width:540,height:960,antialias:!0,powerPreference:"high-performance",sharedTicker:!0,sharedLoader:!0};try{ct.pixiApp=new PIXI.Application(pixiAppSettings)}catch(t){console.error(t),console.warn("[ct.js] Something bad has just happened. This is usually due to hardware problems. I'll try to fix them now, but if the game still doesn't run, try including a legacy renderer in the project's settings."),PIXI.settings.SPRITE_MAX_TEXTURES=Math.min(PIXI.settings.SPRITE_MAX_TEXTURES,16),ct.pixiApp=new PIXI.Application(pixiAppSettings)}PIXI.settings.ROUND_PIXELS=!1,PIXI.Ticker.shared.maxFPS=60,ct.pixiApp.renderer.options.antialias||(PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST),ct.stage=ct.pixiApp.stage,ct.pixiApp.renderer.autoDensity=ct.highDensity,document.getElementById("ct").appendChild(ct.pixiApp.view),ct.u={ldx:(t,e)=>t*Math.cos(e*Math.PI/-180),ldy:(t,e)=>t*Math.sin(e*Math.PI/-180),pdn:(t,e,i,o)=>(-180*Math.atan2(o-e,i-t)/Math.PI+360)%360,pdc:(t,e,i,o)=>Math.sqrt((i-t)*(i-t)+(o-e)*(o-e)),degToRad:t=>t*Math.PI/-180,radToDeg:t=>t/Math.PI*-180,rotate:(t,e,i)=>ct.u.rotateRad(t,e,ct.u.degToRad(i)),rotateRad(t,e,i){const o=Math.sin(i),s=Math.cos(i);return[s*t-o*e,s*e+o*t]},deltaDir(t,e){var i=(e=(e%360+360)%360)-(t=(t%360+360)%360);return i>180&&(i-=360),i<-180&&(i+=360),i},clamp:(t,e,i)=>Math.max(t,Math.min(i,e)),lerp:(t,e,i)=>t+(e-t)*i,unlerp:(t,e,i)=>(i-t)/(e-t),uiToGameCoord:(t,e)=>ct.camera.uiToGameCoord(t,e),gameToUiCoord:(t,e)=>ct.camera.gameToUiCoord(t,e),hexToPixi:t=>Number("0x"+t.slice(1)),pixiToHex:t=>"#"+t.toString(16).padStart(6,0),prect(t,e,i){var o,s,a,n;return i.splice?(o=Math.min(i[0],i[2]),s=Math.max(i[0],i[2]),a=Math.min(i[1],i[3]),n=Math.max(i[1],i[3])):(o=i.x-i.shape.left*i.scale.x,s=i.x+i.shape.right*i.scale.x,a=i.y-i.shape.top*i.scale.y,n=i.y+i.shape.bottom*i.scale.y),t>=o&&e>=a&&t<=s&&e<=n},pcircle:(t,e,i)=>i.splice?ct.u.pdc(t,e,i[0],i[1])<i[2]:ct.u.pdc(0,0,(i.x-t)/i.scale.x,(i.y-e)/i.scale.y)<i.shape.r,ext(t,e,i){if(i)for(const o in i)e[i[o]]&&(t[i[o]]=e[i[o]]);else for(const i in e)t[i]=e[i];return t},load(t,e){var i=document.createElement("script");i.src=t,e&&(i.onload=e),document.getElementsByTagName("head")[0].appendChild(i)},wait:t=>ct.timer.add(t),waitUi:t=>ct.timer.addUi(t)},ct.u.ext(ct.u,{lengthDirX:ct.u.ldx,lengthDirY:ct.u.ldy,pointDirection:ct.u.pdn,pointDistance:ct.u.pdc,pointRectangle:ct.u.prect,pointCircle:ct.u.pcircle,extend:ct.u.ext}),(()=>{const t=e=>{e.kill=!0,e.onDestroy&&(ct.types.onDestroy.apply(e),e.onDestroy.apply(e));for(const i of e.children)i[copyTypeSymbol]&&t(i);const i=ct.stack.indexOf(e);if(-1!==i&&ct.stack.splice(i,1),e.type){const t=ct.types.list[e.type].indexOf(e);-1!==t&&ct.types.list[e.type].splice(t,1)}deadPool.push(e)};ct.loop=function(e){ct.delta=e,ct.deltaUi=PIXI.Ticker.shared.elapsedMS/(1e3/(PIXI.Ticker.shared.maxFPS||60)),ct.inputs.updateActions(),ct.timer.updateTimers(),ct.place.debugTraceGraphics.clear();for(let t=0,e=ct.stack.length;t<e;t++)ct.types.beforeStep.apply(ct.stack[t]),ct.stack[t].onStep.apply(ct.stack[t]),ct.types.afterStep.apply(ct.stack[t]);for(const t of ct.stage.children)t instanceof Room&&(ct.rooms.beforeStep.apply(t),t.onStep.apply(t),ct.rooms.afterStep.apply(t));for(const e of ct.stack)e.kill&&!e._destroyed&&(t(e),e.destroy({children:!0}));for(const t of ct.stage.children)t.children.sort(((t,e)=>(t.depth||0)-(e.depth||0)||(t.uid||0)-(e.uid||0)||0));ct.camera&&(ct.camera.update(ct.delta),ct.camera.manageStage());for(let t=0,e=ct.stack.length;t<e;t++)ct.types.beforeDraw.apply(ct.stack[t]),ct.stack[t].onDraw.apply(ct.stack[t]),ct.types.afterDraw.apply(ct.stack[t]),ct.stack[t].xprev=ct.stack[t].x,ct.stack[t].yprev=ct.stack[t].y;for(const t of ct.stage.children)t instanceof Room&&(ct.rooms.beforeDraw.apply(t),t.onDraw.apply(t),ct.rooms.afterDraw.apply(t));ct.main.fpstick++,ct.rooms.switching&&ct.rooms.forceSwitch()}})();class CtAction{constructor(t){return this.name=t,this.methodCodes=[],this.methodMultipliers=[],this.prevValue=0,this.value=0,this}methodExists(t){return-1!==this.methodCodes.indexOf(t)}addMethod(t,e){if(-1!==this.methodCodes.indexOf(t))throw new Error(`[ct.inputs] An attempt to add an already added input "${t}" to an action "${name}".`);this.methodCodes.push(t),this.methodMultipliers.push(void 0!==e?e:1)}removeMethod(t){const e=this.methodCodes.indexOf(t);-1!==e&&(this.methodCodes.splice(e,1),this.methodMultipliers.splice(e,1))}setMultiplier(t,e){const i=this.methodCodes.indexOf(t);-1!==i?this.methodMultipliers[i]=e:(console.warning(`[ct.inputs] An attempt to change multiplier of a non-existent method "${t}" at event ${this.name}`),console.trace())}update(){this.prevValue=this.value,this.value=0;for(let t=0,e=this.methodCodes.length;t<e;t++){const e=ct.inputs.registry[this.methodCodes[t]]||0;this.value+=e*this.methodMultipliers[t]}this.value=Math.max(-1,Math.min(this.value,1))}reset(){this.prevValue=this.value=0}get pressed(){return 0===this.prevValue&&0!==this.value}get released(){return 0!==this.prevValue&&0===this.value}get down(){return 0!==this.value}}ct.actions={},ct.inputs={registry:{},addAction(t,e){if(t in ct.actions)throw new Error(`[ct.inputs] An action "${t}" already exists, can't add a new one with the same name.`);const i=new CtAction(t);for(const t of e)i.addMethod(t.code,t.multiplier);return ct.actions[t]=i,i},removeAction(t){delete ct.actions[t]},updateActions(){for(const t in ct.actions)ct.actions[t].update()}},ct.inputs.addAction("TOUCH",[{code:"touch.Any"}]),function(ct){const t=0*Math.PI;var e=function(e){const{shape:i}=e,o=new SSCD.Vector(e.x,e.y);if("rect"===i.type){if(0===e.rotation)return o.x-=e.scale.x>0?i.left*e.scale.x:-e.scale.x*i.right,o.y-=e.scale.y>0?i.top*e.scale.y:-i.bottom*e.scale.y,new SSCD.Rectangle(o,new SSCD.Vector(Math.abs((i.left+i.right)*e.scale.x),Math.abs((i.bottom+i.top)*e.scale.y)));const t=ct.u.rotate(-i.left*e.scale.x,-i.top*e.scale.y,e.rotation),s=ct.u.rotate(-i.left*e.scale.x,i.bottom*e.scale.y,e.rotation),a=ct.u.rotate(i.right*e.scale.x,i.bottom*e.scale.y,e.rotation),n=ct.u.rotate(i.right*e.scale.x,-i.top*e.scale.y,e.rotation);return new SSCD.LineStrip(o,[new SSCD.Vector(t[0],t[1]),new SSCD.Vector(s[0],s[1]),new SSCD.Vector(a[0],a[1]),new SSCD.Vector(n[0],n[1])],!0)}if("circle"===i.type){if(Math.abs(e.scale.x)===Math.abs(e.scale.y))return new SSCD.Circle(o,i.r*Math.abs(e.scale.x));const s=[];for(let o=0;o<16;o++){const a=[Math.sin(t/16*o)*i.r*e.scale.x,Math.cos(t/16*o)*i.r*e.scale.y];0!==e.rotation?s.push(ct.u.rotate(a[0],a[1],e.rotation)):s.push(a)}return new SSCD.LineStrip(o,s,!0)}if("strip"===i.type){const t=[];if(0!==e.rotation)for(const o of i.points){const[i,s]=ct.u.rotate(o.x*e.scale.x,o.y*e.scale.y,e.rotation);t.push(new SSCD.Vector(i,s))}else for(const o of i.points)t.push(new SSCD.Vector(o.x*e.scale.x,o.y*e.scale.y));return new SSCD.LineStrip(o,t,Boolean(i.closedStrip))}return"line"===i.type?new SSCD.Line(new SSCD.Vector(e.x+i.x1*e.scale.x,e.y+i.y1*e.scale.y),new SSCD.Vector((i.x2-i.x1)*e.scale.x,(i.y2-i.y1)*e.scale.y)):new SSCD.Circle(o,0)};ct.place={m:1,gridX:200,gridY:200,grid:{},tileGrid:{},getHashes(t){var e=[],i=Math.round(t.x/ct.place.gridX),o=Math.round(t.y/ct.place.gridY),s=Math.sign(t.x-ct.place.gridX*i),a=Math.sign(t.y-ct.place.gridY*o);return e.push(`${i}:${o}`),s&&(e.push(`${i+s}:${o}`),a&&e.push(`${i+s}:${o+a}`)),a&&e.push(`${i}:${o+a}`),e},drawDebugGraphic(t){const i=this._shape||e(this),o=this.$cDebugCollision;let s=this instanceof Copy?26367:65535;if(this.$cHadCollision&&(s=65280),o.lineStyle(2,s),i instanceof SSCD.Rectangle){const e=i.get_position(),a=i.get_size();o.beginFill(s,.1),t?o.drawRect(e.x,e.y,a.x,a.y):o.drawRect(e.x-this.x,e.y-this.y,a.x,a.y),o.endFill()}else if(i instanceof SSCD.LineStrip)if(t){o.moveTo(i.__points[0].x+this.x,i.__points[0].y+this.y);for(let t=1;t<i.__points.length;t++)o.lineTo(i.__points[t].x+this.x,i.__points[t].y+this.y)}else{o.moveTo(i.__points[0].x,i.__points[0].y);for(let t=1;t<i.__points.length;t++)o.lineTo(i.__points[t].x,i.__points[t].y)}else if(i instanceof SSCD.Circle&&i.get_radius()>0)o.beginFill(s,.1),t?o.drawCircle(this.x,this.y,i.get_radius()):o.drawCircle(0,0,i.get_radius()),o.endFill();else if(i instanceof SSCD.Line)if(t){const t=i.get_p1(),e=i.get_p2();o.moveTo(t.x,t.y).lineTo(e.x,e.y)}else o.moveTo(i.__position.x,i.__position.y).lineTo(i.__position.x+i.__dest.x,i.__position.y+i.__dest.y);else t?o.moveTo(-16+this.x,-16+this.y).lineTo(16+this.x,16+this.y).moveTo(-16+this.x,16+this.y).lineTo(16+this.x,-16+this.y):o.moveTo(-16,-16).lineTo(16,16).moveTo(-16,16).lineTo(16,-16)},drawDebugTileGraphic(t){const e=10053375;this.$cDebugCollision.lineStyle(2,e).beginFill(e,.1).drawRect(t.x-this.x,t.y-this.y,t.width,t.height).endFill()},collide(t,i){if(t._shape=t._shape||e(t),i._shape=i._shape||e(i),"complex"===t._shape.__type||"strip"===i._shape.__type||"complex"===i._shape.__type||"strip"===i._shape.__type){const e=t._shape.get_aabb(),o=i._shape.get_aabb();if(!e.intersects(o))return!1}return!!SSCD.CollisionManager.test_collision(t._shape,i._shape)},occupied(t,i,o,s,a){var n=t.x,c=t.y,r=t._shape;let h;var l;"number"==typeof o?(t.x=i,t.y=o):(s=i,a=o,i=t.x,o=t.y),"boolean"==typeof s&&(a=s),n!==t.x||c!==t.y?(t._shape=e(t),h=ct.place.getHashes(t)):h=t.$chashes||ct.place.getHashes(t),a&&(l=[]);for(const e of h){const i=ct.place.grid[e];if(i)for(let e=0,o=i.length;e<o;e++)if(i[e]!==t&&(!s||i[e].$ctype===s)&&ct.place.collide(t,i[e])){if(!a)return n===t.x&&c===t.y||(t.x=n,t.y=c,t._shape=r),i[e];l.includes(i[e])||l.push(i[e])}}return n===t.x&&c===t.y||(t.x=n,t.y=c,t._shape=r),!!a&&l},free:(t,e,i,o)=>!ct.place.occupied(t,e,i,o),meet(t,i,o,s,a){var n=t.x,c=t.y,r=t._shape;let h;var l;"number"==typeof o?(t.x=i,t.y=o):(s=i,a=o,i=t.x,o=t.y),"boolean"==typeof s&&(a=s),n!==t.x||c!==t.y?(t._shape=e(t),h=ct.place.getHashes(t)):h=t.$chashes||ct.place.getHashes(t),a&&(l=[]);for(const e of h){const i=ct.place.grid[e];if(i)for(let e=0,o=i.length;e<o;e++)if(i[e].type===s&&i[e]!==t&&ct.place.collide(t,i[e])){if(!a)return n===t.x&&c===t.y||(t._shape=r,t.x=n,t.y=c),i[e];l.includes(i[e])||l.push(i[e])}}return n===t.x&&c===t.y||(t.x=n,t.y=c,t._shape=r),!!a&&l},tile(t,i,o,s){if(!t.shape||!t.shape.type)return!1;var a=t.x,n=t.y,c=t._shape;let r;void 0!==o?(t.x=i,t.y=o):(s=i,i=t.x,o=t.y),a!==t.x||n!==t.y?(t._shape=e(t),r=ct.place.getHashes(t)):r=t.$chashes||ct.place.getHashes(t);for(const e of r){const i=ct.place.tileGrid[e];if(i)for(let e=0,o=i.length;e<o;e++){const o=i[e],r="string"==typeof s?o.ctype===s:o.depth===s;if((!s||r)&&ct.place.collide(o,t))return a===t.x&&n===t.y||(t.x=a,t.y=n,t._shape=c),!0}}return a===t.x&&n===t.y||(t.x=a,t.y=n,t._shape=c),!1},lastdist:null,nearest(t,e,i){if(ct.types.list[i].length>0){var o=Math.hypot(t-ct.types.list[i][0].x,e-ct.types.list[i][0].y),s=ct.types.list[i][0];for(const a of ct.types.list[i])Math.hypot(t-a.x,e-a.y)<o&&(o=Math.hypot(t-a.x,e-a.y),s=a);return ct.place.lastdist=o,s}return!1},furthest(t,e,i){if(ct.types.list[i].length>0){var o=Math.hypot(t-ct.types.list[i][0].x,e-ct.types.list[i][0].y),s=ct.types.list[i][0];for(const a of ct.types.list[i])Math.hypot(t-a.x,e-a.y)>o&&(o=Math.hypot(t-a.x,e-a.y),s=a);return ct.place.lastdist=o,s}return!1},enableTilemapCollisions(t,e){const i=e||t.ctype;if(t.addedCollisions)throw new Error("[ct.place] The tilemap already has collisions enabled.");for(let e=0,o=t.tiles.length;e<o;e++){const o=t.tiles[e];o._shape=new SSCD.Rectangle(new SSCD.Vector(o.x,o.y),new SSCD.Vector(o.width,o.height)),o.ctype=i,o.$chashes=ct.place.getHashes(o);for(const t of o.$chashes)t in ct.place.tileGrid?ct.place.tileGrid[t].push(o):ct.place.tileGrid[t]=[o];o.depth=t.depth}t.addedCollisions=!0},moveAlong(t,e,i,o,s){"number"==typeof o&&(s=o,o=void 0),s=Math.abs(s||1),i<0&&(i*=-1,e+=180);var a=Math.cos(e*Math.PI/-180)*s,n=Math.sin(e*Math.PI/-180)*s;for(let e=0;e<i;e+=s){const e=ct.place.occupied(t,t.x+a,t.y+n,o)||ct.place.tile(t,t.x+a,t.y+n,o);if(e)return e;t.x+=a,t.y+=n,delete t._shape}return!1},moveByAxes(t,e,i,o,s){"number"==typeof o&&(s=o,o=void 0);const a={x:!1,y:!1};for(s=Math.abs(s||1);Math.abs(e)>s;){const i=ct.place.occupied(t,t.x+Math.sign(e)*s,t.y,o)||ct.place.tile(t,t.x+Math.sign(e)*s,t.y,o);if(i){a.x=i;break}t.x+=Math.sign(e)*s,e-=Math.sign(e)*s}for(;Math.abs(i)>s;){const e=ct.place.occupied(t,t.x,t.y+Math.sign(i)*s,o)||ct.place.tile(t,t.x,t.y+Math.sign(i)*s,o);if(e){a.y=e;break}t.y+=Math.sign(i)*s,i-=Math.sign(i)*s}return Math.abs(e)<s&&ct.place.free(t,t.x+e,t.y,o)&&!ct.place.tile(t,t.x+e,t.y,o)&&(t.x+=e),Math.abs(i)<s&&ct.place.free(t,t.x,t.y+i,o)&&!ct.place.tile(t,t.x,t.y+i,o)&&(t.y+=i),!(!a.x&&!a.y)&&a},go(t,e,i,o,s){if(ct.u.pdc(t.x,t.y,e,i)<o)return void(ct.place.free(t,e,i,s)&&(t.x=e,t.y=i,delete t._shape));var a=ct.u.pdn(t.x,t.y,e,i);let n=t.x+ct.u.ldx(o,a),c=t.y+ct.u.ldy(o,a);if(ct.place.free(t,n,c,s))t.x=n,t.y=c,delete t._shape,t.dir=a;else for(var r=-1;r<=1;r+=2)for(var h=30;h<150;h+=30)if(n=t.x+ct.u.ldx(o,a+h*ct.place.m*r),c=t.y+ct.u.ldy(o,a+h*ct.place.m*r),ct.place.free(t,n,c,s))return t.x=n,t.y=c,delete t._shape,void(t.dir=a+h*ct.place.m*r)},traceCustom(t,e,i,o){const s=[];if(!e)return ct.place.occupied(t,i,o);for(var a in ct.stack)if((!i||ct.stack[a].ctype===i)&&ct.place.collide(t,ct.stack[a])){if(!o)return ct.stack[a];s.push(ct.stack[a])}return s},traceLine(t,e,i){let o=!1;(Math.abs(t.x1-t.x2)>ct.place.gridX||Math.abs(t.y1-t.y2)>ct.place.gridY)&&(o=!0);const s={x:t.x1,y:t.y1,scale:{x:1,y:1},rotation:0,shape:{type:"line",x1:0,y1:0,x2:t.x2-t.x1,y2:t.y2-t.y1}},a=ct.place.traceCustom(s,o,e,i);return i&&a.sort((function(e,i){return ct.u.pdc(t.x1,t.y1,e.x,e.y)-ct.u.pdc(t.x1,t.y1,i.x,i.y)})),a},traceRect(t,e,i){let o=!1;"x1"in(t={...t})&&(t.x=t.x1,t.y=t.y1,t.width=t.x2-t.x1,t.height=t.y2-t.y1),(Math.abs(t.width)>ct.place.gridX||Math.abs(t.height)>ct.place.gridY)&&(o=!0);const s={x:t.x,y:t.y,scale:{x:1,y:1},rotation:0,shape:{type:"rect",left:0,top:0,right:t.width,bottom:t.height}};return ct.place.traceCustom(s,o,e,i)},traceCircle(t,e,i){let o=!1;(2*t.radius>ct.place.gridX||2*t.radius>ct.place.gridY)&&(o=!0);const s={x:t.x,y:t.y,scale:{x:1,y:1},rotation:0,shape:{type:"circle",r:t.radius}};return ct.place.traceCustom(s,o,e,i)},tracePolyline(t,e,i){const o={x:0,y:0,scale:{x:1,y:1},rotation:0,shape:{type:"strip",points:t}};return ct.place.traceCustom(o,!0,e,i)},tracePoint(t,e,i){const o={x:t.x,y:t.y,scale:{x:1,y:1},rotation:0,shape:{type:"point"}};return ct.place.traceCustom(o,!1,e,i)},trace:(t,e,i,o,s)=>ct.place.traceLine({x1:t,y1:e,x2:i,y2:o},s,!0)},ct.place.traceRectange=ct.place.traceRect,setInterval((function(){ct.place.m*=-1}),789)}(ct),function(ct){document.body.style.overflow="hidden";var t=ct.pixiApp.view,e=function(){const{mode:e}=ct.fittoscreen,i=ct.highDensity&&window.devicePixelRatio||1,o=window.innerWidth/ct.roomWidth,s=window.innerHeight/ct.roomHeight;let a=Math.min(o,s);var n,c,r,h;"fastScaleInteger"===e&&(a=a<1?a:Math.floor(a)),"expandViewport"===e||"expand"===e?(n=Math.ceil(window.innerWidth*i),c=Math.ceil(window.innerHeight*i),r=window.innerWidth,h=window.innerHeight):"fastScale"===e||"fastScaleInteger"===e?(n=Math.ceil(ct.roomWidth*i),c=Math.ceil(ct.roomHeight*i),r=ct.roomWidth,h=ct.roomHeight):"scaleFit"!==e&&"scaleFill"!==e||("scaleFill"===e?(n=Math.ceil(ct.roomWidth*o*i),c=Math.ceil(ct.roomHeight*s*i),r=window.innerWidth/a,h=window.innerHeight/a):(n=Math.ceil(ct.roomWidth*a*i),c=Math.ceil(ct.roomHeight*a*i),r=ct.roomWidth,h=ct.roomHeight)),ct.pixiApp.renderer.resize(n,c),ct.pixiApp.stage.scale.x=ct.pixiApp.stage.scale.y="scaleFill"!==e&&"scaleFit"!==e?i:i*a,t.style.width=Math.ceil(n/i)+"px",t.style.height=Math.ceil(c/i)+"px",ct.camera.width=r,ct.camera.height=h,"fastScale"===e||"fastScaleInteger"===e?(t.style.transform=`translate(-50%, -50%) scale(${a})`,t.style.position="absolute",t.style.top="50%",t.style.left="50%"):"expandViewport"===e||"expand"===e||"scaleFill"===e?(t.style.position="static",t.style.top="unset",t.style.left="unset"):"scaleFit"===e&&(t.style.transform="translate(-50%, -50%)",t.style.position="absolute",t.style.top="50%",t.style.left="50%")},i=function t(){!function(){try{const t=require("electron").remote.BrowserWindow.getFocusedWindow();return void t.setFullScreen(!t.isFullScreen())}catch(t){}var t=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,e=document.getElementById("ct"),i=e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen,o=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if(t)o&&o.call(document);else{var s=i.call(e);s&&s.catch((function(t){console.error("[ct.fittoscreen]",t)}))}}(),document.removeEventListener("mouseup",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t)};window.addEventListener("resize",e),ct.fittoscreen=e,ct.fittoscreen.toggleFullscreen=function(){document.addEventListener("mouseup",i),document.addEventListener("keyup",i),document.addEventListener("click",i)};var o="scaleFill";Object.defineProperty(ct.fittoscreen,"mode",{configurable:!1,enumerable:!0,set(t){o=t},get:()=>o}),ct.fittoscreen.mode=o,ct.fittoscreen.getIsFullscreen=function(){try{return require("electron").remote.BrowserWindow.getFocusedWindow.isFullScreen}catch(t){}return document.fullscreen||document.webkitIsFullScreen||document.mozFullScreen}}(ct),function(){var t=function(t,e){ct.inputs.registry["mouse."+t]=e},e={0:"Left",1:"Middle",2:"Right",3:"Special1",4:"Special2",5:"Special3",6:"Special4",7:"Special5",8:"Special6",unknown:"Unknown"};ct.mouse={xui:0,yui:0,xprev:0,yprev:0,xuiprev:0,yuiprev:0,inside:!1,pressed:!1,down:!1,released:!1,button:0,hovers:t=>!!t.shape&&("rect"===t.shape.type?ct.u.prect(ct.mouse.x,ct.mouse.y,t):"circle"===t.shape.type?ct.u.pcircle(ct.mouse.x,ct.mouse.y,t):"point"===t.shape.type&&(ct.mouse.x===t.x&&ct.mouse.y===t.y)),hoversUi:t=>!!t.shape&&("rect"===t.shape.type?ct.u.prect(ct.mouse.xui,ct.mouse.yui,t):"circle"===t.shape.type?ct.u.pcircle(ct.mouse.xui,ct.mouse.yui,t):"point"===t.shape.type&&(ct.mouse.xui===t.x&&ct.mouse.yui===t.y)),hide(){ct.pixiApp.renderer.view.style.cursor="none"},show(){ct.pixiApp.renderer.view.style.cursor=""},get x(){return ct.u.uiToGameCoord(ct.mouse.xui,ct.mouse.yui)[0]},get y(){return ct.u.uiToGameCoord(ct.mouse.xui,ct.mouse.yui)[1]}},ct.mouse.listenerMove=function(t){var e=ct.pixiApp.view.getBoundingClientRect();ct.mouse.xui=(t.clientX-e.left)*ct.camera.width/e.width,ct.mouse.yui=(t.clientY-e.top)*ct.camera.height/e.height,ct.mouse.xui>0&&ct.mouse.yui>0&&ct.mouse.yui<ct.camera.height&&ct.mouse.xui<ct.camera.width?ct.mouse.inside=!0:ct.mouse.inside=!1,window.focus()},ct.mouse.listenerDown=function(i){t(e[i.button]||e.unknown,1),ct.mouse.pressed=!0,ct.mouse.down=!0,ct.mouse.button=i.button,window.focus(),i.preventDefault()},ct.mouse.listenerUp=function(i){t(e[i.button]||e.unknown,0),ct.mouse.released=!0,ct.mouse.down=!1,ct.mouse.button=i.button,window.focus(),i.preventDefault()},ct.mouse.listenerContextMenu=function(t){t.preventDefault()},ct.mouse.listenerWheel=function(e){t("Wheel",(e.wheelDelta||-e.detail)<0?-1:1)},ct.mouse.setupListeners=function(){document.addEventListener?(document.addEventListener("mousemove",ct.mouse.listenerMove,!1),document.addEventListener("mouseup",ct.mouse.listenerUp,!1),document.addEventListener("mousedown",ct.mouse.listenerDown,!1),document.addEventListener("wheel",ct.mouse.listenerWheel,!1,{passive:!1}),document.addEventListener("contextmenu",ct.mouse.listenerContextMenu,!1),document.addEventListener("DOMMouseScroll",ct.mouse.listenerWheel,{passive:!1})):(document.attachEvent("onmousemove",ct.mouse.listenerMove),document.attachEvent("onmouseup",ct.mouse.listenerUp),document.attachEvent("onmousedown",ct.mouse.listenerDown),document.attachEvent("onmousewheel",ct.mouse.listenerWheel),document.attachEvent("oncontextmenu",ct.mouse.listenerContextMenu))}}(),function(){var t=function(t,e){ct.inputs.registry["keyboard."+t]=e};ct.keyboard={string:"",lastKey:"",lastCode:"",alt:!1,shift:!1,ctrl:!1,clear(){delete ct.keyboard.lastKey,delete ct.keyboard.lastCode,ct.keyboard.string="",ct.keyboard.alt=!1,ct.keyboard.shift=!1,ct.keyboard.ctrl=!1},check:[],onDown(e){ct.keyboard.shift=e.shiftKey,ct.keyboard.alt=e.altKey,ct.keyboard.ctrl=e.ctrlKey,ct.keyboard.lastKey=e.key,ct.keyboard.lastCode=e.code,e.code?t(e.code,1):t("Unknown",1),e.key&&(1===e.key.length?ct.keyboard.string+=e.key:"Backspace"===e.key?ct.keyboard.string=ct.keyboard.string.slice(0,-1):"Enter"===e.key&&(ct.keyboard.string="")),e.preventDefault()},onUp(e){ct.keyboard.shift=e.shiftKey,ct.keyboard.alt=e.altKey,ct.keyboard.ctrl=e.ctrlKey,e.code?t(e.code,0):t("Unknown",0),e.preventDefault()}},document.addEventListener?(document.addEventListener("keydown",ct.keyboard.onDown,!1),document.addEventListener("keyup",ct.keyboard.onUp,!1)):(document.attachEvent("onkeydown",ct.keyboard.onDown),document.attachEvent("onkeyup",ct.keyboard.onUp))}(),function(t){"use strict";var e="KeyboardEvent"in t;e||(t.KeyboardEvent=function(){throw TypeError("Illegal constructor")}),[["DOM_KEY_LOCATION_STANDARD",0],["DOM_KEY_LOCATION_LEFT",1],["DOM_KEY_LOCATION_RIGHT",2],["DOM_KEY_LOCATION_NUMPAD",3]].forEach((function(e){e[0]in t.KeyboardEvent||(t.KeyboardEvent[e[0]]=e[1])}));var i=t.KeyboardEvent.DOM_KEY_LOCATION_STANDARD,o=t.KeyboardEvent.DOM_KEY_LOCATION_LEFT,s=t.KeyboardEvent.DOM_KEY_LOCATION_RIGHT,a=t.KeyboardEvent.DOM_KEY_LOCATION_NUMPAD;function n(t,e){return-1!==String(t).indexOf(e)}var c=n(navigator.platform,"Win")?"win":n(navigator.platform,"Mac")?"mac":n(navigator.platform,"CrOS")?"cros":n(navigator.platform,"Linux")?"linux":n(navigator.userAgent,"iPad")||n(navigator.platform,"iPod")||n(navigator.platform,"iPhone")?"ios":"",r=n(navigator.userAgent,"Chrome/")?"chrome":n(navigator.vendor,"Apple")?"safari":n(navigator.userAgent,"MSIE")?"ie":n(navigator.userAgent,"Gecko/")?"moz":n(navigator.userAgent,"Opera/")?"opera":"",h=r+"-"+c;function l(t,e,i){h!==e&&r!==e&&c!==e||Object.keys(i).forEach((function(e){t[e]=i[e]}))}var d={3:{code:"Cancel"},6:{code:"Help"},8:{code:"Backspace"},9:{code:"Tab"},12:{code:"Clear"},13:{code:"Enter"},16:{code:"Shift"},17:{code:"Control"},18:{code:"Alt"},19:{code:"Pause"},20:{code:"CapsLock"},21:{code:"KanaMode"},22:{code:"Lang1"},25:{code:"Lang2"},27:{code:"Escape"},28:{code:"Convert"},29:{code:"NonConvert"},30:{code:"Accept"},31:{code:"ModeChange"},32:{code:"Space"},33:{code:"PageUp"},34:{code:"PageDown"},35:{code:"End"},36:{code:"Home"},37:{code:"ArrowLeft"},38:{code:"ArrowUp"},39:{code:"ArrowRight"},40:{code:"ArrowDown"},41:{code:"Select"},42:{code:"Print"},43:{code:"Execute"},44:{code:"PrintScreen"},45:{code:"Insert"},46:{code:"Delete"},47:{code:"Help"},48:{code:"Digit0",keyCap:"0"},49:{code:"Digit1",keyCap:"1"},50:{code:"Digit2",keyCap:"2"},51:{code:"Digit3",keyCap:"3"},52:{code:"Digit4",keyCap:"4"},53:{code:"Digit5",keyCap:"5"},54:{code:"Digit6",keyCap:"6"},55:{code:"Digit7",keyCap:"7"},56:{code:"Digit8",keyCap:"8"},57:{code:"Digit9",keyCap:"9"},65:{code:"KeyA",keyCap:"a"},66:{code:"KeyB",keyCap:"b"},67:{code:"KeyC",keyCap:"c"},68:{code:"KeyD",keyCap:"d"},69:{code:"KeyE",keyCap:"e"},70:{code:"KeyF",keyCap:"f"},71:{code:"KeyG",keyCap:"g"},72:{code:"KeyH",keyCap:"h"},73:{code:"KeyI",keyCap:"i"},74:{code:"KeyJ",keyCap:"j"},75:{code:"KeyK",keyCap:"k"},76:{code:"KeyL",keyCap:"l"},77:{code:"KeyM",keyCap:"m"},78:{code:"KeyN",keyCap:"n"},79:{code:"KeyO",keyCap:"o"},80:{code:"KeyP",keyCap:"p"},81:{code:"KeyQ",keyCap:"q"},82:{code:"KeyR",keyCap:"r"},83:{code:"KeyS",keyCap:"s"},84:{code:"KeyT",keyCap:"t"},85:{code:"KeyU",keyCap:"u"},86:{code:"KeyV",keyCap:"v"},87:{code:"KeyW",keyCap:"w"},88:{code:"KeyX",keyCap:"x"},89:{code:"KeyY",keyCap:"y"},90:{code:"KeyZ",keyCap:"z"},91:{code:"MetaLeft",location:o},92:{code:"MetaRight",location:s},93:{code:"ContextMenu"},95:{code:"Standby"},96:{code:"Numpad0",keyCap:"0",location:a},97:{code:"Numpad1",keyCap:"1",location:a},98:{code:"Numpad2",keyCap:"2",location:a},99:{code:"Numpad3",keyCap:"3",location:a},100:{code:"Numpad4",keyCap:"4",location:a},101:{code:"Numpad5",keyCap:"5",location:a},102:{code:"Numpad6",keyCap:"6",location:a},103:{code:"Numpad7",keyCap:"7",location:a},104:{code:"Numpad8",keyCap:"8",location:a},105:{code:"Numpad9",keyCap:"9",location:a},106:{code:"NumpadMultiply",keyCap:"*",location:a},107:{code:"NumpadAdd",keyCap:"+",location:a},108:{code:"NumpadComma",keyCap:",",location:a},109:{code:"NumpadSubtract",keyCap:"-",location:a},110:{code:"NumpadDecimal",keyCap:".",location:a},111:{code:"NumpadDivide",keyCap:"/",location:a},112:{code:"F1"},113:{code:"F2"},114:{code:"F3"},115:{code:"F4"},116:{code:"F5"},117:{code:"F6"},118:{code:"F7"},119:{code:"F8"},120:{code:"F9"},121:{code:"F10"},122:{code:"F11"},123:{code:"F12"},124:{code:"F13"},125:{code:"F14"},126:{code:"F15"},127:{code:"F16"},128:{code:"F17"},129:{code:"F18"},130:{code:"F19"},131:{code:"F20"},132:{code:"F21"},133:{code:"F22"},134:{code:"F23"},135:{code:"F24"},144:{code:"NumLock",location:a},145:{code:"ScrollLock"},160:{code:"ShiftLeft",location:o},161:{code:"ShiftRight",location:s},162:{code:"ControlLeft",location:o},163:{code:"ControlRight",location:s},164:{code:"AltLeft",location:o},165:{code:"AltRight",location:s},166:{code:"BrowserBack"},167:{code:"BrowserForward"},168:{code:"BrowserRefresh"},169:{code:"BrowserStop"},170:{code:"BrowserSearch"},171:{code:"BrowserFavorites"},172:{code:"BrowserHome"},173:{code:"AudioVolumeMute"},174:{code:"AudioVolumeDown"},175:{code:"AudioVolumeUp"},176:{code:"MediaTrackNext"},177:{code:"MediaTrackPrevious"},178:{code:"MediaStop"},179:{code:"MediaPlayPause"},180:{code:"LaunchMail"},181:{code:"MediaSelect"},182:{code:"LaunchApp1"},183:{code:"LaunchApp2"},186:{code:"Semicolon",keyCap:";"},187:{code:"Equal",keyCap:"="},188:{code:"Comma",keyCap:","},189:{code:"Minus",keyCap:"-"},190:{code:"Period",keyCap:"."},191:{code:"Slash",keyCap:"/"},192:{code:"Backquote",keyCap:"`"},219:{code:"BracketLeft",keyCap:"["},220:{code:"Backslash",keyCap:"\\"},221:{code:"BracketRight",keyCap:"]"},222:{code:"Quote",keyCap:"'"},226:{code:"IntlBackslash",keyCap:"\\"},229:{code:"Process"},246:{code:"Attn"},247:{code:"CrSel"},248:{code:"ExSel"},249:{code:"EraseEof"},250:{code:"Play"},251:{code:"ZoomToggle"},254:{code:"Clear"}};l(d,"moz",{59:{code:"Semicolon",keyCap:";"},61:{code:"Equal",keyCap:"="},107:{code:"Equal",keyCap:"="},109:{code:"Minus",keyCap:"-"},187:{code:"NumpadAdd",keyCap:"+",location:a},189:{code:"NumpadSubtract",keyCap:"-",location:a}}),l(d,"moz-mac",{12:{code:"NumLock",location:a},173:{code:"Minus",keyCap:"-"}}),l(d,"moz-win",{173:{code:"Minus",keyCap:"-"}}),l(d,"chrome-mac",{93:{code:"MetaRight",location:s}}),l(d,"safari",{3:{code:"Enter"},25:{code:"Tab"}}),l(d,"ios",{10:{code:"Enter",location:i}}),l(d,"safari-mac",{91:{code:"MetaLeft",location:o},93:{code:"MetaRight",location:s},229:{code:"KeyQ",keyCap:"Q"}});var p={};"cros"===c&&(p["U+00A0"]={code:"ShiftLeft",location:o},p["U+00A1"]={code:"ShiftRight",location:s},p["U+00A2"]={code:"ControlLeft",location:o},p["U+00A3"]={code:"ControlRight",location:s},p["U+00A4"]={code:"AltLeft",location:o},p["U+00A5"]={code:"AltRight",location:s}),"chrome-mac"===h&&(p["U+0010"]={code:"ContextMenu"}),"safari-mac"===h&&(p["U+0010"]={code:"ContextMenu"}),"ios"===c&&(p["U+0010"]={code:"Function"},p["U+001C"]={code:"ArrowLeft"},p["U+001D"]={code:"ArrowRight"},p["U+001E"]={code:"ArrowUp"},p["U+001F"]={code:"ArrowDown"},p["U+0001"]={code:"Home"},p["U+0004"]={code:"End"},p["U+000B"]={code:"PageUp"},p["U+000C"]={code:"PageDown"});var u=[];u[o]={16:{code:"ShiftLeft",location:o},17:{code:"ControlLeft",location:o},18:{code:"AltLeft",location:o}},u[s]={16:{code:"ShiftRight",location:s},17:{code:"ControlRight",location:s},18:{code:"AltRight",location:s}},u[a]={13:{code:"NumpadEnter",location:a}},l(u[a],"moz",{109:{code:"NumpadSubtract",location:a},107:{code:"NumpadAdd",location:a}}),l(u[o],"moz-mac",{224:{code:"MetaLeft",location:o}}),l(u[s],"moz-mac",{224:{code:"MetaRight",location:s}}),l(u[s],"moz-win",{91:{code:"MetaRight",location:s}}),l(u[s],"mac",{93:{code:"MetaRight",location:s}}),l(u[a],"chrome-mac",{12:{code:"NumLock",location:a}}),l(u[a],"safari-mac",{12:{code:"NumLock",location:a},187:{code:"NumpadAdd",location:a},189:{code:"NumpadSubtract",location:a},190:{code:"NumpadDecimal",location:a},191:{code:"NumpadDivide",location:a}});var m={ShiftLeft:{key:"Shift"},ShiftRight:{key:"Shift"},ControlLeft:{key:"Control"},ControlRight:{key:"Control"},AltLeft:{key:"Alt"},AltRight:{key:"Alt"},MetaLeft:{key:"Meta"},MetaRight:{key:"Meta"},NumpadEnter:{key:"Enter"},Space:{key:" "},Digit0:{key:"0",shiftKey:")"},Digit1:{key:"1",shiftKey:"!"},Digit2:{key:"2",shiftKey:"@"},Digit3:{key:"3",shiftKey:"#"},Digit4:{key:"4",shiftKey:"$"},Digit5:{key:"5",shiftKey:"%"},Digit6:{key:"6",shiftKey:"^"},Digit7:{key:"7",shiftKey:"&"},Digit8:{key:"8",shiftKey:"*"},Digit9:{key:"9",shiftKey:"("},KeyA:{key:"a",shiftKey:"A"},KeyB:{key:"b",shiftKey:"B"},KeyC:{key:"c",shiftKey:"C"},KeyD:{key:"d",shiftKey:"D"},KeyE:{key:"e",shiftKey:"E"},KeyF:{key:"f",shiftKey:"F"},KeyG:{key:"g",shiftKey:"G"},KeyH:{key:"h",shiftKey:"H"},KeyI:{key:"i",shiftKey:"I"},KeyJ:{key:"j",shiftKey:"J"},KeyK:{key:"k",shiftKey:"K"},KeyL:{key:"l",shiftKey:"L"},KeyM:{key:"m",shiftKey:"M"},KeyN:{key:"n",shiftKey:"N"},KeyO:{key:"o",shiftKey:"O"},KeyP:{key:"p",shiftKey:"P"},KeyQ:{key:"q",shiftKey:"Q"},KeyR:{key:"r",shiftKey:"R"},KeyS:{key:"s",shiftKey:"S"},KeyT:{key:"t",shiftKey:"T"},KeyU:{key:"u",shiftKey:"U"},KeyV:{key:"v",shiftKey:"V"},KeyW:{key:"w",shiftKey:"W"},KeyX:{key:"x",shiftKey:"X"},KeyY:{key:"y",shiftKey:"Y"},KeyZ:{key:"z",shiftKey:"Z"},Numpad0:{key:"0"},Numpad1:{key:"1"},Numpad2:{key:"2"},Numpad3:{key:"3"},Numpad4:{key:"4"},Numpad5:{key:"5"},Numpad6:{key:"6"},Numpad7:{key:"7"},Numpad8:{key:"8"},Numpad9:{key:"9"},NumpadMultiply:{key:"*"},NumpadAdd:{key:"+"},NumpadComma:{key:","},NumpadSubtract:{key:"-"},NumpadDecimal:{key:"."},NumpadDivide:{key:"/"},Semicolon:{key:";",shiftKey:":"},Equal:{key:"=",shiftKey:"+"},Comma:{key:",",shiftKey:"<"},Minus:{key:"-",shiftKey:"_"},Period:{key:".",shiftKey:">"},Slash:{key:"/",shiftKey:"?"},Backquote:{key:"`",shiftKey:"~"},BracketLeft:{key:"[",shiftKey:"{"},Backslash:{key:"\\",shiftKey:"|"},BracketRight:{key:"]",shiftKey:"}"},Quote:{key:"'",shiftKey:'"'},IntlBackslash:{key:"\\",shiftKey:"|"}};l(m,"mac",{MetaLeft:{key:"Meta"},MetaRight:{key:"Meta"}});var y,f,g,x={Add:"+",Decimal:".",Divide:"/",Subtract:"-",Multiply:"*",Spacebar:" ",Esc:"Escape",Nonconvert:"NonConvert",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Menu:"ContextMenu",MediaNextTrack:"MediaTrackNext",MediaPreviousTrack:"MediaTrackPrevious",SelectMedia:"MediaSelect",HalfWidth:"Hankaku",FullWidth:"Zenkaku",RomanCharacters:"Romaji",Crsel:"CrSel",Exsel:"ExSel",Zoom:"ZoomToggle"},w=(y=d,f="code",g={},Object.keys(y).forEach((function(t){var e=y[t];f in e&&(g[e[f]]=e)})),g);try{var k=e&&"location"in new KeyboardEvent("")}catch(t){}function v(t){var e="keyCode"in t?t.keyCode:"which"in t?t.which:0,i=function(){if(k||"keyLocation"in t){var i=k?t.location:t.keyLocation;if(i&&e in u[i])return u[i][e]}return"keyIdentifier"in t&&t.keyIdentifier in p?p[t.keyIdentifier]:e in d?d[e]:null}();if(!i)return null;var o,s=(o=m[i.code])?t.shiftKey&&"shiftKey"in o?o.shiftKey:o.key:i.code;return{code:i.code,key:s,location:i.location,keyCap:i.keyCap}}"KeyboardEvent"in t&&"defineProperty"in Object&&function(){function t(t,e,i){e in t||Object.defineProperty(t,e,i)}if(t(KeyboardEvent.prototype,"code",{get:function(){var t=v(this);return t?t.code:""}}),"key"in KeyboardEvent.prototype){var e=Object.getOwnPropertyDescriptor(KeyboardEvent.prototype,"key");Object.defineProperty(KeyboardEvent.prototype,"key",{get:function(){var t=e.get.call(this);return x.hasOwnProperty(t)?x[t]:t}})}t(KeyboardEvent.prototype,"key",{get:function(){var t=v(this);return t&&"key"in t?t.key:"Unidentified"}}),t(KeyboardEvent.prototype,"location",{get:function(){var t=v(this);return t&&"location"in t?t.location:i}}),t(KeyboardEvent.prototype,"locale",{get:function(){return""}})}(),"queryKeyCap"in t.KeyboardEvent||(t.KeyboardEvent.queryKeyCap=function(t,e){if(t=String(t),!w.hasOwnProperty(t))return"Undefined";if(e&&"en-us"!==String(e).toLowerCase())throw Error("Unsupported locale");var i=w[t];return i.keyCap||i.code||"Undefined"}),t.identifyKey=function(t){if(!("code"in t)){var e=v(t);t.code=e?e.code:"",t.key=e&&"key"in e?e.key:"Unidentified",t.location="location"in t?t.location:"keyLocation"in t?t.keyLocation:e&&"location"in e?e.location:i,t.locale=""}}}(self),function(){ct.sound={},ct.sound.howler=Howler,Howler.orientation(0,-1,0,0,0,1),Howler.pos(0,0,0),ct.sound.howl=Howl;var t=[][0]||2500;ct.sound.useDepth=!1,ct.sound.manageListenerPosition=!1,ct.sound.detect=Howler.codecs,ct.sound.init=function(t,e,i){i=i||{};var o=[];e.wav&&".wav"===e.wav.slice(-4)&&o.push(e.wav),e.mp3&&".mp3"===e.mp3.slice(-4)&&o.push(e.mp3),e.ogg&&".ogg"===e.ogg.slice(-4)&&o.push(e.ogg);var s=new Howl({src:o,autoplay:!1,preload:!i.music,html5:Boolean(i.music),loop:i.loop,pool:i.poolSize||5,onload:function(){i.music||ct.res.soundsLoaded++},onloaderror:function(){ct.res.soundsError++,s.buggy=!0,console.error("[ct.sound.howler] Oh no! We couldn't load "+(e.wav||e.mp3||e.ogg)+"!")}});i.music&&ct.res.soundsLoaded++,ct.res.sounds[t]=s};ct.sound.spawn=function(e,i,o){"function"==typeof(i=i||{})&&(o=i,i={});var s=ct.res.sounds[e],a=s.play();if(i.loop&&s.loop(!0,a),void 0!==i.volume&&s.volume(i.volume,a),void 0!==i.rate&&s.rate(i.rate,a),void 0!==i.x||i.position){if(void 0!==i.x)s.pos(i.x,i.y||0,i.z||0,a);else{const t=i.position;s.pos(t.x,t.y,i.z||(ct.sound.useDepth?t.depth:0),a)}((e,i,o)=>{e.pannerAttr({coneInnerAngle:i.coneInnerAngle||360,coneOuterAngle:i.coneOuterAngle||360,coneOuterGain:i.coneOuterGain||1,distanceModel:i.distanceModel||"linear",maxDistance:i.maxDistance||t,refDistance:i.refDistance||1,rolloffFactor:i.rolloffFactor||1,panningModel:i.panningModel||"HRTF"},o)})(s,i,a)}return o&&s.once("end",o,a),a},ct.sound.stop=function(t,e){ct.sound.playing(t,e)&&ct.res.sounds[t].stop(e)},ct.sound.pause=function(t,e){ct.res.sounds[t].pause(e)},ct.sound.resume=function(t,e){ct.res.sounds[t].play(e)},ct.sound.playing=function(t,e){return ct.res.sounds[t].playing(e)},ct.sound.load=function(t){ct.res.sounds[t].load()},ct.sound.volume=function(t,e,i){return ct.res.sounds[t].volume(e,i)},ct.sound.fade=function(t,e,i,o){if(ct.sound.playing(t,o)){var s=ct.res.sounds[t],a=o?s.volume(o):s.volume;try{s.fade(a,e,i,o)}catch(i){console.warn("Could not reliably fade a sound, reason:",i),ct.sound.volume(t,e,o)}}},ct.sound.moveListener=function(t,e,i){Howler.pos(t,e,i||0)},ct.sound.position=function(t,e,i,o,s){if(ct.sound.playing(t,e)){var a=ct.res.sounds[t],n=a.pos(e);a.pos(i,o,s||n[2],e)}},ct.sound.globalVolume=Howler.volume.bind(Howler),ct.sound.exists=function(t){return t in ct.res.sounds}}(),ct.tween={add(t){var e={obj:t.obj,fields:t.fields||{},curve:t.curve||ct.tween.ease,duration:t.duration||1e3,timer:new CtTimer(this.duration,!1,t.useUiDelta||!1)},i=new Promise(((t,i)=>{for(var o in e.resolve=t,e.reject=i,e.starting={},e.fields)e.starting[o]=e.obj[o]||0;ct.tween.tweens.push(e)}));return t.silent&&(i.catch((()=>{})),e.timer.catch((()=>{}))),i.stop=function(){e.reject({code:0,info:"Stopped by game logic",from:"ct.tween"})},i},linear:(t,e,i)=>e*i+t,ease:(t,e,i)=>(i*=2)<1?e/2*i*i+t:-e/2*(--i*(i-2)-1)+t,easeInQuad:(t,e,i)=>e*i*i+t,easeOutQuad:(t,e,i)=>-e*i*(i-2)+t,easeInCubic:(t,e,i)=>e*i*i*i+t,easeOutCubic:(t,e,i)=>e*(--i*i*i+1)+t,easeInOutCubic:(t,e,i)=>(i*=2)<1?e/2*i*i*i+t:e/2*((i-=2)*i*i+2)+t,easeInOutQuart:(t,e,i)=>(i*=2)<1?e/2*i*i*i*i+t:-e/2*((i-=2)*i*i*i-2)+t,easeInQuart:(t,e,i)=>e*i*i*i*i+t,easeOutQuart:(t,e,i)=>-e*(--i*i*i*i-1)+t,easeInCirc:(t,e,i)=>-e*(Math.sqrt(1-i*i)-1)+t,easeOutCirc:(t,e,i)=>(i--,e*Math.sqrt(1-i*i)+t),easeInOutCirc:(t,e,i)=>(i*=2)<1?-e/2*(Math.sqrt(1-i*i)-1)+t:(i-=2,e/2*(Math.sqrt(1-i*i)+1)+t),easeInBack(t,e,i){const o=1.70158;return e*(2.70158*i*i*i-o*i*i)+t},easeOutBack(t,e,i){const o=1.70158;return e*(1+2.70158*(i-1)**3+o*(i-1)**2)+t},easeInOutBack(t,e,i){const o=2.5949095;return e*(i<.5?(2*i)**2*(7.189819*i-o)/2:((2*i-2)**2*((o+1)*(2*i-2)+o)+2)/2)+t},easeInElastic(t,e,i){const o=2*Math.PI/3;return e*(0===i?0:1===i?1:-(2**(10*i-10))*Math.sin((10*i-10.75)*o))+t},easeOutElastic(t,e,i){const o=2*Math.PI/3;return e*(0===i?0:1===i?1:2**(-10*i)*Math.sin((10*i-.75)*o)+1)+t},easeInOutElastic(t,e,i){const o=2*Math.PI/4.5;return e*(0===i?0:1===i?1:i<.5?-(2**(20*i-10))*Math.sin((20*i-11.125)*o)/2:2**(-20*i+10)*Math.sin((20*i-11.125)*o)/2+1)+t},easeOutBounce(t,e,i){const o=7.5625,s=2.75;return e*(i<1/s?o*i*i:i<2/s?o*(i-=1.5/s)*i+.75:i<2.5/s?o*(i-=2.25/s)*i+.9375:o*(i-=2.625/s)*i+.984375)+t},easeInBounce(t,e,i){const o=7.5625,s=2.75;return e*(1-((i=1-i)<1/s?o*i*i:i<2/s?o*(i-=1.5/s)*i+.75:i<2.5/s?o*(i-=2.25/s)*i+.9375:o*(i-=2.625/s)*i+.984375))+t},easeInOutBounce(t,e,i){const o=7.5625,s=2.75;var a;return(a=i<.5?1-2*i:2*i-1)<1/s?o*a*a:a<2/s?o*(a-=1.5/s)*a+.75:a<2.5/s?o*(a-=2.25/s)*a+.9375:o*(a-=2.625/s)*a+.984375,e*(i<.5?(1-a)/1:(1+a)/1)+t},tweens:[],wait:ct.u.wait},ct.tween.easeInOutQuad=ct.tween.ease,function(ct){var t=function(t,e){ct.inputs.registry["touch."+t]=e},e=0,i=0,o=0,s=0,a=0,n=()=>{t("Any",ct.touch.events.length>0?1:0),t("Double",ct.touch.events.length>1?1:0),t("Triple",ct.touch.events.length>2?1:0)},c=t=>{const e=ct.pixiApp.view.getBoundingClientRect(),i=(t.clientX-e.left)/e.width*ct.camera.width,o=(t.clientY-e.top)/e.height*ct.camera.height,s=ct.u.uiToGameCoord(i,o);return{id:t.identifier,x:s[0],y:s[1],xui:i,yui:o,xprev:s[0],yprev:s[1],xuiprev:i,yuiprev:o,r:t.radiusX?Math.max(t.radiusX,t.radiusY):0}},r=t=>{for(let e=0;e<ct.touch.events.length;e++)if(ct.touch.events[e].id===t)return ct.touch.events[e];return!1},h=t=>{for(let e=0;e<ct.touch.events.length;e++)if(ct.touch.events[e].id===t)return e;return-1},l=function(t){t.preventDefault();for(let i=0,o=t.changedTouches.length;i<o;i++){var e=c(t.changedTouches[i]);ct.touch.events.push(e),ct.touch.x=e.x,ct.touch.y=e.y,ct.touch.xui=e.xui,ct.touch.yui=e.yui}n()},d=function(t){t.preventDefault();for(let e=0,i=t.changedTouches.length;e<i;e++){const i=t.changedTouches[e],o=r(t.changedTouches[e].identifier);if(o){const t=ct.pixiApp.view.getBoundingClientRect();o.xui=(i.clientX-t.left)/t.width*ct.camera.width,o.yui=(i.clientY-t.top)/t.height*ct.camera.height,[o.x,o.y]=ct.u.uiToGameCoord(o.xui,o.yui),o.r=i.radiusX?Math.max(i.radiusX,i.radiusY):0,ct.touch.x=o.x,ct.touch.y=o.y,ct.touch.xui=o.xui,ct.touch.yui=o.yui}}},p=function(t){t.preventDefault();var e=t.changedTouches;for(let t=0;t<e.length;t++){const i=h(e[t].identifier);-1!==i&&ct.touch.released.push(ct.touch.events.splice(i,1)[0])}n()},u=function(t){const e=ct.pixiApp.view.getBoundingClientRect();var i={id:-1,xui:(t.clientX-e.left)*ct.camera.width/e.width,yui:(t.clientY-e.top)*ct.camera.height/e.height,r:0};[i.x,i.y]=ct.u.uiToGameCoord(i.xui,i.yui),ct.touch.events.push(i),ct.touch.x=i.x,ct.touch.y=i.y,ct.touch.xui=i.xui,ct.touch.yui=i.yui,n()},m=function(t){const e=ct.pixiApp.view.getBoundingClientRect(),i=r(-1);i&&(i.xui=(t.clientX-e.left)*ct.camera.width/e.width,i.yui=(t.clientY-e.top)*ct.camera.height/e.height,[i.x,i.y]=ct.u.uiToGameCoord(i.xui,i.yui),ct.touch.x=i.x,ct.touch.y=i.y,ct.touch.xui=i.xui,ct.touch.yui=i.yui)},y=function(){var t=h(-1);-1!==t&&ct.touch.events.splice(t,1),n()};ct.touch={released:[],setupListeners(){document.addEventListener("touchstart",l,!1),document.addEventListener("touchstart",(()=>{ct.touch.enabled=!0}),{once:!0}),document.addEventListener("touchend",p,!1),document.addEventListener("touchcancel",p,!1),document.addEventListener("touchmove",d,!1)},setupMouseListeners(){document.addEventListener("mousemove",m,!1),document.addEventListener("mouseup",y,!1),document.addEventListener("mousedown",u,!1)},enabled:!1,events:[],x:0,y:0,xprev:0,yprev:0,xui:0,yui:0,xuiprev:0,yuiprev:0,clear(){ct.touch.events.length=0,ct.touch.clearReleased(),n()},clearReleased(){ct.touch.released.length=0},collide(t,e,i){var o=i?ct.touch.released:ct.touch.events;if(void 0!==e&&!1!==e){const i=h(e);return-1!==i&&ct.place.collide(t,{x:o[i].x,y:o[i].y,shape:{type:o[i].r?"circle":"point",r:o[i].r},scale:{x:1,y:1}})}for(let e=0,i=o.length;e<i;e++)if(ct.place.collide(t,{x:o[e].x,y:o[e].y,shape:{type:o[e].r?"circle":"point",r:o[e].r},scale:{x:1,y:1}}))return!0;return!1},collideUi(t,e,i){var o=i?ct.touch.released:ct.touch.events;if(void 0!==e&&!1!==e){const i=h(e);return-1!==i&&ct.place.collide(t,{x:o[i].xui,y:o[i].yui,shape:{type:o[i].r?"circle":"point",r:o[i].r},scale:{x:1,y:1}})}for(let e=0,i=o.length;e<i;e++)if(ct.place.collide(t,{x:o[e].xui,y:o[e].yui,shape:{type:o[e].r?"circle":"point",r:o[e].r},scale:{x:1,y:1}}))return!0;return!1},hovers:(t,e,i)=>ct.mouse&&ct.mouse.hovers(t)||ct.touch.collide(t,e,i),hoversUi:(t,e,i)=>ct.mouse&&ct.mouse.hoversUi(t)||ct.touch.collideUi(t,e,i),getById:r,updateGestures:function(){let n=0,c=0;const r=ct.pixiApp.view.getBoundingClientRect();for(const t of ct.touch.events)n+=(t.clientX-r.left)/r.width,c+=(t.clientY-r.top)/r.height;n/=ct.touch.events.length,c/=ct.touch.events.length;let h=0,l=s;if(ct.touch.events.length>1){const t=[ct.touch.events[0],ct.touch.events[1]].sort(((t,e)=>t.id-e.id));h=ct.u.pdn(t[0].x,t[0].y,t[1].x,t[1].y),l=ct.u.pdc(t[0].x,t[0].y,t[1].x,t[1].y)}e===ct.touch.events.length?(ct.touch.events.length>1?(t("DeltaRotation",ct.u.degToRad(ct.u.deltaDir(a,h))),t("DeltaPinch",l/s-1)):(t("DeltaPinch",0),t("DeltaRotation",0)),ct.touch.events.length?(t("PanX",n-i),t("PanY",c-o)):(t("PanX",0),t("PanY",0))):(e=ct.touch.events.length,t("DeltaPinch",0),t("DeltaRotation",0),t("PanX",0),t("PanY",0)),i=n,o=c,a=h,s=l}}}(ct),ct.random=function(t){return Math.random()*t},ct.u.ext(ct.random,{dice:(...t)=>t[Math.floor(Math.random()*t.length)],range:(t,e)=>t+Math.random()*(e-t),deg:()=>360*Math.random(),coord:()=>[Math.floor(Math.random()*ct.width),Math.floor(Math.random()*ct.height)],chance:(t,e)=>e?Math.random()*e<t:100*Math.random()<t,from:t=>t[Math.floor(Math.random()*t.length)],createSeededRandomizer:t=>function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}});{const t={};t.currentRootRandomizer=ct.random.createSeededRandomizer(456852),ct.random.seeded=function(){return t.currentRootRandomizer()},ct.random.setSeed=function(e){t.currentRootRandomizer=ct.random.createSeededRandomizer(e)},ct.random.setSeed(9323846264)}const __is_test=!0,dbg=!0,screen={};let ending=!1;class Room extends PIXI.Container{static getNewId(){return this.roomId++,this.roomId}constructor(t){if(super(),this.x=this.y=0,this.uid=Room.getNewId(),this.tileLayers=[],this.backgrounds=[],ct.room||(ct.room=ct.rooms.current=this),t){t.extends&&ct.u.ext(this,t.extends),this.onCreate=t.onCreate,this.onStep=t.onStep,this.onDraw=t.onDraw,this.onLeave=t.onLeave,this.template=t,this.name=t.name,this===ct.room&&(ct.pixiApp.renderer.backgroundColor=ct.u.hexToPixi(this.template.backgroundColor)),ct.fittoscreen();for(let e=0,i=t.bgs.length;e<i;e++){const i=new ct.types.Background(t.bgs[e].texture,null,t.bgs[e].depth,t.bgs[e].extends);this.addChild(i)}for(let e=0,i=t.tiles.length;e<i;e++){const i=new Tilemap(t.tiles[e]);i.cache(),this.tileLayers.push(i),this.addChild(i)}for(let e=0,i=t.objects.length;e<i;e++){const i=t.objects[e].exts||{};ct.types.make(t.objects[e].type,t.objects[e].x,t.objects[e].y,{tx:t.objects[e].tx,ty:t.objects[e].ty,tr:t.objects[e].tr,...i},this)}}return this}get x(){return-this.position.x}set x(t){return this.position.x=-t,t}get y(){return-this.position.y}set y(t){return this.position.y=-t,t}}Room.roomId=0,function(){var t;ct.rooms={templates:{},list:{},addBg(t,e){const i=new ct.types.Background(t,null,e);return ct.room.addChild(i),i},addTileLayer:t=>ct.tilemaps.create(t),clear(){ct.stage.children=[],ct.stack=[];for(const t in ct.types.list)ct.types.list[t]=[];for(const t in ct.backgrounds.list)ct.backgrounds.list[t]=[];ct.rooms.list={};for(const t in ct.rooms.templates)ct.rooms.list[t]=[]},remove(t){if(!(t instanceof Room)){if("string"==typeof t)throw new Error("[ct.rooms] To remove a room, you should provide a reference to it (to an object), not its name. Provided value:",t);throw new Error("[ct.rooms] An attempt to remove a room that is not actually a room! Provided value:",t)}const e=ct.rooms.list[t.name];-1!==e?ct.rooms.list[t.name].splice(e,1):console.warn("[ct.rooms] Removing a room that was not found in ct.rooms.list. This is strange…"),t.kill=!0,ct.stage.removeChild(t);for(const e of t.children)e.kill=!0;t.onLeave(),ct.rooms.onLeave.apply(t)},switch(e){ct.rooms.templates[e]?(t=e,ct.rooms.switching=!0):console.error('[ct.rooms] The room "'+e+'" does not exist!')},switching:!1,append(t,e){if(!(t in ct.rooms.templates))return console.error(`[ct.rooms] append failed: the room ${t} does not exist!`),!1;const i=new Room(ct.rooms.templates[t]);return e&&ct.u.ext(i,e),ct.stage.addChild(i),i.onCreate(),ct.rooms.onCreate.apply(i),ct.rooms.list[t].push(i),i},prepend(t,e){if(!(t in ct.rooms.templates))return console.error(`[ct.rooms] prepend failed: the room ${t} does not exist!`),!1;const i=new Room(ct.rooms.templates[t]);return e&&ct.u.ext(i,e),ct.stage.addChildAt(i,0),i.onCreate(),ct.rooms.onCreate.apply(i),ct.rooms.list[t].push(i),i},merge(t){if(!(t in ct.rooms.templates))return console.error(`[ct.rooms] merge failed: the room ${t} does not exist!`),!1;const e={copies:[],tileLayers:[],backgrounds:[]},i=ct.rooms.templates[t],o=ct.room;for(const t of i.bgs){const i=new ct.types.Background(t.texture,null,t.depth,t.extends);o.backgrounds.push(i),o.addChild(i),e.backgrounds.push(i)}for(const t of i.tiles){const i=new Tilemap(t);o.tileLayers.push(i),o.addChild(i),e.tileLayers.push(i),i.cache()}for(const t of i.objects){const i=ct.types.make(t.type,t.x,t.y,{tx:t.tx||1,ty:t.ty||1,tr:t.tr||0},o);e.copies.push(i)}return e},forceSwitch(e){t&&(e=t),ct.room&&(ct.room.onLeave(),ct.rooms.onLeave.apply(ct.room),ct.room=void 0),ct.rooms.clear(),deadPool.length=0;var i=ct.rooms.templates[e];ct.roomWidth=i.width,ct.roomHeight=i.height,ct.camera=new Camera(ct.roomWidth/2,ct.roomHeight/2,ct.roomWidth,ct.roomHeight),i.cameraConstraints&&(ct.camera.minX=i.cameraConstraints.x1,ct.camera.maxX=i.cameraConstraints.x2,ct.camera.minY=i.cameraConstraints.y1,ct.camera.maxY=i.cameraConstraints.y2),ct.pixiApp.renderer.resize(i.width,i.height),ct.rooms.current=ct.room=new Room(i),ct.stage.addChild(ct.room),ct.room.onCreate(),ct.rooms.onCreate.apply(ct.room),ct.rooms.list[e].push(ct.room),ct.camera.manageStage(),ct.rooms.switching=!1,t=void 0},onCreate(){if(this===ct.room){ct.place.tileGrid={};const t=new PIXI.Graphics;t.depth=1e7,ct.room.addChild(t),ct.place.debugTraceGraphics=t}for(const t of this.tileLayers)-1!==this.children.indexOf(t)&&ct.place.enableTilemapCollisions(t)},onLeave(){if(this===ct.room&&(ct.place.grid={}),!this.kill){for(var t of ct.tween.tweens)t.reject({info:"Room switch",code:1,from:"ct.tween"});ct.tween.tweens=[]}},starting:"Start"}}(),ct.room=null,ct.rooms.beforeStep=function(){ct.touch.updateGestures();for(var t=0;t<ct.tween.tweens.length;){var e=ct.tween.tweens[t];if(e.obj.kill)e.reject({code:2,info:"Copy is killed"}),ct.tween.tweens.splice(t,1);else{var i=e.timer.time/e.duration;for(var o in i>1&&(i=1),e.fields){var s=e.starting[o],a=e.fields[o]-e.starting[o];e.obj[o]=e.curve(s,a,i)}1!==i?t++:(e.resolve(e.fields),ct.tween.tweens.splice(t,1))}}},ct.rooms.afterStep=function(){},ct.rooms.beforeDraw=function(){},ct.rooms.afterDraw=function(){ct.mouse.xprev=ct.mouse.x,ct.mouse.yprev=ct.mouse.y,ct.mouse.xuiprev=ct.mouse.xui,ct.mouse.yuiprev=ct.mouse.yui,ct.mouse.pressed=ct.mouse.released=!1,ct.inputs.registry["mouse.Wheel"]=0,ct.sound.follow&&!ct.sound.follow.kill?ct.sound.howler.pos(ct.sound.follow.x,ct.sound.follow.y,ct.sound.useDepth?ct.sound.follow.z:0):ct.sound.manageListenerPosition&&ct.sound.howler.pos(ct.camera.x,ct.camera.y,ct.camera.z||0),ct.keyboard.clear();for(const t of ct.touch.events)t.xprev=t.x,t.yprev=t.y,t.xuiprev=t.x,t.yuiprev=t.y,ct.touch.clearReleased()},ct.rooms.templates.GameRoom={name:"GameRoom",width:540,height:960,objects:JSON.parse('[{"x":177,"y":22,"exts":{},"type":"Gauge_bg"},{"x":0,"y":0,"exts":{},"type":"Cartoon"}]'),bgs:JSON.parse('[{"depth":-99,"texture":"cloud_bg","extends":{}},{"depth":99,"texture":"dim","extends":{}},{"depth":400,"texture":"dimmed","extends":{}}]'),tiles:JSON.parse('[{"depth":-10,"tiles":[],"extends":{}}]'),backgroundColor:"#6BCAFF",onStep(){switch(this._state){case 0:if(0===this.cnt){this.cnt=1;const t={Obs:10,DarkCloud:20,Bubble:20,Balloon:10,Gap:70};this.makeObs(t),this.gauge=ct.types.copy("Gauge",180,25);break}if(90===this.cnt){ct.types.list.Cartoon[0].kill=!0,this.dimmed.alpha=0,this.setState(29);break}this.cnt++;break;case 29:0===this.cnt&&(this.cnt=1,ct.types.copy("Sign",ct.camera.x,ct.camera.y));break;case 30:if(0===this.cnt){this.cnt=1,this.dim.alpha=0,this.ch.setState(1);break}20===this.cnt&&this.chState(31),this.cnt++;break;case 31:if(0===this.cnt){this.cnt=1;break}if(this.gauge.decreaseGauge(),ct.actions.TOUCH.pressed&&!this._isDragging&&(this._isDragging=!0,this.ch.acceleration=.1),ct.actions.TOUCH.released&&this._isDragging&&(this._isDragging=!1,this.ch.acceleration=.1),this.lastCloud=ct.types.list.Cloud[ct.types.list.Cloud.length-1],ct.room.ch.y-this.lastCloud.y<ct.camera.height){const t={Obs:40,DarkCloud:10,Bubble:30,Balloon:40,Gap:70,maxDarkcloud:4};this.makeObs(t)}Math.abs(this.ch.timetableY-this.ch.y)>=2e3&&(this.ch.timetableY=this.ch.y,this.increaseTime());break;case 41:if(0===this.cnt)this.cnt=1,ct.pixiApp.ticker.speed=0,this.dimmed.alpha=1,this.cartoon=ct.types.copy("Cartoon",ct.camera.x,ct.camera.y),this.cartoon.setToon(1),window._ut.muted(!0),ct.types.copy("Cloud_no",this.ch.x-40,this.ch.y+130);else if(180===this.cnt){this.dimmed.alpha=0,this.cartoon.kill=!0,ct.pixiApp.ticker.speed=1,window._ut.muted(!1),this.setState(32);break}this.cnt++;break;case 32:if(0===this.cnt){this.cnt=1;break}if(this.gauge.decreaseGauge(),ct.actions.TOUCH.pressed&&!this._isDragging&&(this._isDragging=!0,this.ch.acceleration=.1),ct.actions.TOUCH.released&&this._isDragging&&(this._isDragging=!1,this.ch.acceleration=.1),this.lastCloud=ct.types.list.Cloud[ct.types.list.Cloud.length-1],ct.room.ch.y-this.lastCloud.y<ct.camera.height){const t={Obs:45,DarkCloud:20,Bubble:30,Balloon:40,Gap:70,maxDarkcloud:4};this.makeObs(t)}Math.abs(this.ch.timetableY-this.ch.y)>=2e3&&(this.ch.timetableY=this.ch.y,this.increaseTime());break;case 42:if(0===this.cnt)this.cnt=1,ct.pixiApp.ticker.speed=0,this.dimmed.alpha=1,this.cartoon=ct.types.copy("Cartoon",ct.camera.x,ct.camera.y),this.cartoon.setToon(2),window._ut.muted(!0),ct.types.copy("Cloud_no",this.ch.x-40,this.ch.y+130);else if(180===this.cnt){this.dimmed.alpha=0,this.cartoon.kill=!0,ct.pixiApp.ticker.speed=1,window._ut.muted(!1),this.setState(33);break}this.cnt++;break;case 33:if(0===this.cnt){this.cnt=1,ct.pixiApp.renderer.backgroundColor=ct.u.hexToPixi("#fb97be");break}if(this.gauge.decreaseGauge(),ct.actions.TOUCH.pressed&&!this._isDragging&&(this._isDragging=!0,this.ch.acceleration=.1),ct.actions.TOUCH.released&&this._isDragging&&(this._isDragging=!1,this.ch.acceleration=.1),this.lastCloud=ct.types.list.Cloud[ct.types.list.Cloud.length-1],ct.room.ch.y-this.lastCloud.y<ct.camera.height){const t={Obs:50,DarkCloud:30,Bubble:30,Balloon:40,Gap:75,maxDarkcloud:4};this.makeObs(t)}Math.abs(this.ch.timetableY-this.ch.y)>=2e3&&(this.ch.timetableY=this.ch.y,this.increaseTime());break;case 43:if(0===this.cnt)this.cnt=1,ct.pixiApp.ticker.speed=0,this.dimmed.alpha=1,this.cartoon=ct.types.copy("Cartoon",ct.camera.x,ct.camera.y),this.cartoon.setToon(3),window._ut.muted(!0),ct.types.copy("Cloud_no",this.ch.x-40,this.ch.y+130);else if(180===this.cnt){this.dimmed.alpha=0,this.cartoon.kill=!0,ct.pixiApp.ticker.speed=1,window._ut.muted(!1),this.setState(34);break}this.cnt++;break;case 34:if(0===this.cnt){this.cnt=1,ct.pixiApp.renderer.backgroundColor=ct.u.hexToPixi("#6E2063");break}if(this.gauge.decreaseGauge(),ct.actions.TOUCH.pressed&&!this._isDragging&&(this._isDragging=!0,this.ch.acceleration=.1),ct.actions.TOUCH.released&&this._isDragging&&(this._isDragging=!1,this.ch.acceleration=.1),this.lastCloud=ct.types.list.Cloud[ct.types.list.Cloud.length-1],ct.room.ch.y-this.lastCloud.y<ct.camera.height){const t={Obs:55,DarkCloud:30,Bubble:30,Balloon:50,Gap:80,maxDarkcloud:4};this.makeObs(t)}Math.abs(this.ch.timetableY-this.ch.y)>=2e3&&(this.ch.timetableY=this.ch.y,this.increaseTime());break;case 44:if(0===this.cnt)this.cnt=1,ct.pixiApp.ticker.speed=0,this.dimmed.alpha=1,this.cartoon=ct.types.copy("Cartoon",ct.camera.x,ct.camera.y),this.cartoon.setToon(4),window._ut.muted(!0),ct.types.copy("Cloud_no",this.ch.x-40,this.ch.y+130);else if(180===this.cnt){this.dimmed.alpha=0,this.cartoon.kill=!0,ct.pixiApp.ticker.speed=1,window._ut.muted(!1),this.setState(35);break}this.cnt++;break;case 35:if(0===this.cnt){this.cnt=1,ct.pixiApp.renderer.backgroundColor=ct.u.hexToPixi("#6E2063");break}if(this.gauge.decreaseGauge(),ct.actions.TOUCH.pressed&&!this._isDragging&&(this._isDragging=!0,this.ch.acceleration=.1),ct.actions.TOUCH.released&&this._isDragging&&(this._isDragging=!1,this.ch.acceleration=.1),this.lastCloud=ct.types.list.Cloud[ct.types.list.Cloud.length-1],ct.room.ch.y-this.lastCloud.y<ct.camera.height){const t={Obs:60,DarkCloud:20,Bubble:30,Balloon:50,Gap:80,maxDarkcloud:4};this.makeObs(t)}Math.abs(this.ch.timetableY-this.ch.y)>=2e3&&(this.ch.timetableY=this.ch.y,this.increaseTime());break;case 45:if(0===this.cnt)this.cnt=1,ct.pixiApp.ticker.speed=0,this.dimmed.alpha=1,this.cartoon=ct.types.copy("Cartoon",ct.camera.x,ct.camera.y),this.cartoon.setToon(5),window._ut.muted(!0);else if(300===this.cnt){this.dimmed.alpha=0,this.cartoon.kill=!0,ct.pixiApp.ticker.speed=1,window._ut.muted(!1),ending=!0,ct.rooms.switch("GameOver");break}this.cnt++}},onDraw(){this.timetableLabel.y=ct.camera.y-ct.camera.height/2+20},onLeave(){},onCreate(){if(-1!=window.navigator.userAgent.indexOf("SamsungBrowser")){const t=document.querySelector("canvas");t.style.width=window.outerWidth+"px",t.style.height=window.outerHeight+"px"}this._isPc=!1,screen.width>720&&(this._isPc=!0),this._isDragging=!1,this.timetable=6,this.MAXHEART=3e3,this._heartGauge=this.MAXHEART,this.itemHeart=400,this.dim=ct.backgrounds.list.dim[0],this.dimmed=ct.backgrounds.list.dimmed[0],this.dimmed.alpha=0,this.ch=ct.types.copy("Ch",185,715),this.lastCloud=ct.types.copy("Cloud",175,130),this.timetableLabel=new PIXI.Text((this.timetable<12?"오전":"오후")+" "+this.timetable+"시",ct.styles.get("ageText")),this.timetableLabel.x=20,this.timetableLabel.y=ct.camera.y-ct.camera.height/2+20,this.timetableLabel.depth=50,this.addChild(this.timetableLabel),this._state=0,this.cnt=0,this._timeEnd=!1,this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this._state=t,this.cnt=0})).catch((t=>{})):(this._state=t,this.cnt=0)},this.chState=function(t,e){this._timeEnd||this.setState(t,e)},this.playGame=function(){if(console.log("[ROOM::playGame] "),window._ut.isLocal()||__is_test){console.log("테스트라 통신안함");return document.querySelector(".ct-aLoadingScreen").classList.add("hidden"),void this.setState(29)}},this.increaseTime=function(){this.timetable++;let t=this.timetable<12?"오전":"오후",e=this.timetable%12;12==this.timetable?e=12:24==this.timetable&&(t="오전"),this.timetableLabel.text=t+" "+e+"시",15===this.timetable?(this.ch.addEvtQ(30),this.setState(41)):18===this.timetable?this.setState(42):21===this.timetable?this.setState(43):24===this.timetable?this.setState(44):25===this.timetable&&this.setState(45)},this.makeObs=function(t){const e=this._isPc?1:2;let i=0,o=null;const{Obs:s,DarkCloud:a,Bubble:n,Balloon:c}=t,{maxDarkcloud:r}=t,{Gap:h}=t;for(var l=1;l<=20;l+=e)ct.random.chance(s)?ct.random.chance(a)&&i<r&&!o?(o=ct.types.copy("DarkCloud",window._ut.randBetween(screen.startX,screen.endX-210),this.lastCloud.y-h*l+window._ut.randBetween(-30,30)),i++):ct.random.chance(c)?(ct.types.copy("Balloon",window._ut.randBetween(screen.startX,screen.endX-90),this.lastCloud.y-h*l+window._ut.randBetween(-30,30)),o=null):ct.random.chance(n)?(ct.types.copy("Bubble",window._ut.randBetween(screen.startX,screen.endX-200),this.lastCloud.y-h*l+window._ut.randBetween(-30,30)),o=null):(ct.types.copy("Cloud",window._ut.randBetween(screen.startX,screen.endX-210),this.lastCloud.y-h*l+window._ut.randBetween(-30,30)),o=null):(ct.types.copy("Cloud",window._ut.randBetween(screen.startX,screen.endX-210),this.lastCloud.y-h*l+window._ut.randBetween(-30,30)),o=null)}},extends:{}},ct.rooms.templates.GameOver={name:"GameOver",width:540,height:960,objects:JSON.parse("[]"),bgs:JSON.parse("[]"),tiles:JSON.parse('[{"depth":-10,"tiles":[{"texture":"end_bad","frame":0,"x":0,"y":0,"width":541,"height":961}],"extends":{}}]'),backgroundColor:"#000000",onStep(){ct.actions.TOUCH.pressed&&window._ut.isBetweenPos(ct.touch,this.btn1)&&this.isTouch&&(this.isTouch=!1,ct.sound.spawn("pop"),ct.rooms.switch("GameRoom"))},onDraw(){},onLeave(){},onCreate(){if(-1!=window.navigator.userAgent.indexOf("SamsungBrowser")){const t=document.querySelector("canvas");t.style.width=window.outerWidth+"px",t.style.height=window.outerHeight+"px"}ct.sound.spawn("fail"),this.btn1={x:150,y:840,w:240,h:100},this.isTouch=!0,ending&&(this.cartoon=ct.types.copy("Cartoon"),this.cartoon.setTex("end"),ct.types.copy("NextBtn",436,900))},extends:{}},ct.rooms.templates.Start={name:"Start",width:540,height:960,objects:JSON.parse("[]"),bgs:JSON.parse("[]"),tiles:JSON.parse('[{"depth":-10,"tiles":[{"texture":"start","frame":0,"x":0,"y":0,"width":541,"height":960}],"extends":{}}]'),backgroundColor:"#000000",onStep(){switch(this._state){case 0:if(0===this.cnt){this.cnt=1;document.querySelector(".ct-aLoadingScreen").classList.add("hidden");break}if(ct.actions.TOUCH.pressed&&window._ut.isBetweenPos(ct.touch,this.btn1)&&this.isText){if(this.isText=!1,!(screen.width>720)){this._state=1,ct.sound.spawn("pop"),ct.types.copy("Cartoon",0,0).setTex("guide");break}ct.types.copy("Text",270,778)}break;case 1:if(ct.actions.TOUCH.pressed&&window._ut.isBetweenPos(ct.touch,this.btn2)){this._state=2,ct.sound.spawn("pop"),ct.rooms.switch("GameRoom");break}}},onDraw(){},onLeave(){},onCreate(){if(-1!=window.navigator.userAgent.indexOf("SamsungBrowser")){const t=document.querySelector("canvas");t.style.width=window.outerWidth+"px",t.style.height=window.outerHeight+"px"}screen.startX=ct.camera.x-ct.camera.width/2,screen.endX=ct.camera.x+ct.camera.width/2,screen.width=ct.camera.width,screen.height=ct.camera.height,this._state=0,this.cnt=0,this.btn1={x:140,y:810,w:250,h:100},this.btn2={x:360,y:880,w:150,h:60},this.isText=!0},extends:{}},ct.styles={types:{},new:(t,e)=>(ct.styles.types[t]=e,e),get:(t,e)=>!0===e?ct.u.ext({},ct.styles.types[t]):e?ct.u.ext(ct.u.ext({},ct.styles.types[t]),e):ct.styles.types[t]},ct.styles.new("ageText",{fontFamily:"sans-serif",fontSize:28,fontStyle:"normal",fontWeight:400,lineJoin:"round",lineHeight:37.800000000000004,fill:"#FFFFFF",strokeThickness:5,stroke:"#000000"}),ct.styles.new("warnText",{fontFamily:"sans-serif",fontSize:21,fontStyle:"normal",fontWeight:"600",lineJoin:"round",lineHeight:28.35,fill:"#FFFFFF",strokeThickness:5,stroke:"#000000"});class EmitterTandem extends PIXI.Container{constructor(t,e){super(),this.emitters=[],this.delayed=[];for(const i of t){const t=new PIXI.particles.Emitter(this,ct.res.getTexture(i.texture),i.settings),o=i.settings.delay+e.prewarmDelay;o>0?(t.emit=!1,this.delayed.push({value:o,emitter:t})):o<0?(t.emit=!0,t.update(-o)):t.emit=!0,t.initialDeltaPos={x:i.settings.pos.x,y:i.settings.pos.y},this.emitters.push(t),t.playOnce((()=>{this.emitters.splice(this.emitters.indexOf(t),1)}))}this.isUi=e.isUi,this.scale.x=e.scale.x,this.scale.y=e.scale.y,e.rotation?this.rotation=ct.u.radToDeg(e.rotation):e.angle&&(this.angle=e.angle),this.deltaPosition=e.position,this.depth=e.depth,this.paused=this.frozen=!1,this.isUi?ct.emitters.uiTandems.push(this):ct.emitters.tandems.push(this)}update(){if(this.stopped)for(const t of this.emitters)t.particleCount||this.emitters.splice(this.emitters.indexOf(t),1);if(this.appendant&&this.appendant._destroyed||this.kill||!this.emitters.length)return this.emit("done"),this.isUi?ct.emitters.uiTandems.splice(ct.emitters.uiTandems.indexOf(this),1):ct.emitters.tandems.splice(ct.emitters.tandems.indexOf(this),1),void this.destroy();if(this.frozen)return;const t=(this.isUi?PIXI.Ticker.shared.elapsedMS:PIXI.Ticker.shared.deltaMS)/1e3;for(const e of this.delayed)e.value-=t,e.value<=0&&(e.emitter.emit=!0,this.delayed.splice(this.delayed.indexOf(e),1));for(const e of this.emitters)this.delayed.find((t=>t.emitter===e))||e.update(t);this.follow&&this.updateFollow()}stop(){if(this.stopped)console.trace("[ct.emitters] An attempt to stop an already stopped emitter tandem. Continuing…");else{this.stopped=!0;for(const t of this.emitters)t.emit=!1;this.delayed=[]}}pause(){for(const t of this.emitters)t.oldMaxParticles=t.maxParticles,t.maxParticles=0}resume(){for(const t of this.emitters)t.maxParticles=t.oldMaxParticles||t.maxParticles}clear(){for(const t of this.emitters)t.cleanup()}updateFollow(){if(!this.follow)return;if(this.follow.kill||!this.follow.scale)return this.follow=null,void this.stop();const t=ct.u.rotate(this.deltaPosition.x*this.follow.scale.x,this.deltaPosition.y*this.follow.scale.y,-this.follow.angle);for(const e of this.emitters){e.updateOwnerPos(this.follow.x+t[0],this.follow.y+t[1]);const i=ct.u.rotate(e.initialDeltaPos.x*this.follow.scale.x,e.initialDeltaPos.y*this.follow.scale.y,-this.follow.angle);e.updateSpawnPos(i[0],i[1])}}}!function(){const t={prewarmDelay:0,scale:{x:1,y:1},tint:16777215,alpha:1,position:{x:0,y:0},isUi:!1,depth:1/0};ct.emitters={templates:{Heart_:[{texture:"Heart",settings:{alpha:{list:[{value:0,time:0},{value:1,time:.5},{value:0,time:1}],isStepped:!1},scale:{list:[{value:1.5,time:0},{value:3,time:1}],isStepped:!1},color:{list:[{value:"ffffff",time:0},{value:"ffffff",time:.5},{value:"ffffff",time:1}],isStepped:!1},blendMode:"normal",speed:{list:[{value:500,time:0},{value:100,time:1}],isStepped:!1},startRotation:{min:260,max:280},rotationSpeed:{min:0,max:0},rotationAcceleration:0,lifetime:{min:.5,max:2},frequency:.03,spawnChance:1,particlesPerWave:1,angleStart:270,emitterLifetime:1,maxParticles:1e3,maxSpeed:0,pos:{x:96,y:56},acceleration:{x:0,y:0},addAtBack:!1,spawnType:"rect",spawnCircle:{x:0,y:0,r:32},delay:0,spawnRect:{x:-30,y:-20,w:60,h:40},noRotation:!0}}],Twingcle:[{texture:"Heart",settings:{alpha:{list:[{value:0,time:0},{value:1,time:.5},{value:0,time:1}],isStepped:!1},scale:{list:[{value:2,time:0},{value:1,time:1}],isStepped:!1},color:{list:[{value:"ffffff",time:0},{value:"ffffff",time:.5},{value:"ffffff",time:1}],isStepped:!1},blendMode:"normal",speed:{list:[{value:0,time:0},{value:0,time:1}],isStepped:!1},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:0},rotationAcceleration:0,lifetime:{min:.5,max:.5},frequency:.02,spawnChance:1,particlesPerWave:1,angleStart:270,emitterLifetime:1,maxParticles:50,maxSpeed:0,pos:{x:48,y:32},acceleration:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:65},delay:0,noRotation:!0}}],Heart_shot:[{texture:"Heart",settings:{alpha:{list:[{value:.0049999999999999906,time:0},{time:.1,value:.51},{value:1,time:.5},{value:0,time:1}],isStepped:!1},scale:{list:[{value:1.5,time:0},{value:3,time:1}],isStepped:!1},color:{list:[{value:"ffffff",time:0},{time:.1,value:"FFFFFF"},{value:"ffffff",time:.5},{value:"ffffff",time:1}],isStepped:!1},blendMode:"normal",speed:{list:[{value:250,time:0},{value:50,time:1}],isStepped:!1},startRotation:{min:85,max:95},rotationSpeed:{min:0,max:0},rotationAcceleration:0,lifetime:{min:.5,max:4},frequency:.02,spawnChance:1,particlesPerWave:1,angleStart:270,emitterLifetime:0,maxParticles:1e3,maxSpeed:0,pos:{x:48,y:88},acceleration:{x:0,y:0},addAtBack:!1,spawnType:"rect",spawnCircle:{x:0,y:0,r:200,minR:100},delay:0,spawnRect:{x:-20,y:-24,w:40,h:48},noRotation:!0}}]}||{},uiTandems:[],tandems:[],fire(e,i,o,s){if(!(e in ct.emitters.templates))throw new Error(`[ct.emitters] An attempt to create a non-existent emitter ${e}.`);const a=Object.assign({},t,s),n=new EmitterTandem(ct.emitters.templates[e],a);return n.x=i,n.y=o,a.room?(a.room.addChild(n),n.isUi=a.room.isUi):(ct.room.addChild(n),n.isUi=ct.room.isUi),n},append(e,i,o){if(!(i in ct.emitters.templates))throw new Error(`[ct.emitters] An attempt to create a non-existent emitter ${i}.`);const s=Object.assign({},t,o),a=new EmitterTandem(ct.emitters.templates[i],s);return s.position&&(a.x=s.position.x,a.y=s.position.y),a.appendant=e,e.addChild(a),a},follow(e,i,o){if(!(i in ct.emitters.templates))throw new Error(`[ct.emitters] An attempt to create a non-existent emitter ${i}.`);const s=Object.assign({},t,o),a=new EmitterTandem(ct.emitters.templates[i],s);return a.follow=e,a.updateFollow(),"getRoom"in e?e.getRoom().addChild(a):ct.room.addChild(a),a}},PIXI.Ticker.shared.add((()=>{for(const t of ct.emitters.uiTandems)t.update();for(const t of ct.emitters.tandems)t.update()}))}(),function(ct){const t=new PIXI.Loader,e=document.querySelector(".ct-aLoadingScreen"),i=e.querySelector(".ct-aLoadingBar"),o=window.dragonBones?dragonBones.PixiFactory.factory:null;ct.res={soundsLoaded:0,soundsTotal:2,soundsError:0,sounds:{},registry:{cloud_3:{frames:1,shape:{type:"rect",top:-40,bottom:69,left:-15,right:194},anchor:{x:0,y:0}},cloud_1:{frames:1,shape:{type:"rect",top:-27,bottom:55,left:-20,right:189},anchor:{x:0,y:0}},dim:{atlas:"./img/t0.png",frames:0,shape:{type:"rect",top:0,bottom:960,left:0,right:540},anchor:{x:0,y:0}},cloud_2:{frames:1,shape:{type:"rect",top:-20,bottom:59,left:-30,right:179},anchor:{x:0,y:0}},cloud_bg:{atlas:"./img/t1.png",frames:0,shape:{type:"rect",top:0,bottom:667,left:0,right:522},anchor:{x:0,y:0}},"gauge-bg":{frames:1,shape:{type:"rect",top:0,bottom:30,left:0,right:305},anchor:{x:0,y:0}},en4:{frames:1,shape:{type:"rect",top:0,bottom:71,left:0,right:86},anchor:{x:0,y:0}},Heart:{frames:1,shape:{type:"rect",top:0,bottom:16,left:0,right:16},anchor:{x:0,y:0}},en3:{frames:1,shape:{type:"rect",top:-65,bottom:120,left:-23,right:105},anchor:{x:0,y:0}},en2:{frames:1,shape:{type:"rect",top:-62,bottom:120,left:-15,right:108},anchor:{x:0,y:0}},en1:{frames:1,shape:{type:"rect",top:-71,bottom:121,left:-17,right:109},anchor:{x:0,y:0}},monkey:{frames:1,shape:{type:"rect",top:0,bottom:118,left:0,right:121},anchor:{x:0,y:0}},wo1:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},love3:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:116},anchor:{x:0,y:0}},song3:{frames:1,shape:{type:"rect",top:0,bottom:112,left:0,right:121},anchor:{x:0,y:0}},song2:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},love1:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},song1:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},wo2:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},bum1:{frames:1,shape:{type:"rect",top:0,bottom:119,left:0,right:120},anchor:{x:0,y:0}},song4:{frames:1,shape:{type:"rect",top:0,bottom:121,left:0,right:121},anchor:{x:0,y:0}},end:{frames:1,shape:{type:"rect",top:0,bottom:961,left:0,right:541},anchor:{x:0,y:0}},dimmed:{atlas:"./img/t2.png",frames:0,shape:{type:"rect",top:0,bottom:960,left:0,right:540},anchor:{x:0,y:0}},cut_0:{frames:1,shape:{type:"rect",top:0,bottom:961,left:0,right:541},anchor:{x:0,y:0}},cut_2:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},cut_1:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},cut_3:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},guide:{frames:1,shape:{type:"rect",top:0,bottom:960,left:0,right:541},anchor:{x:0,y:0}},cut_4:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},cut_5:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},end_bad:{frames:1,shape:{type:"rect",top:480,bottom:481,left:270,right:271},anchor:{x:.49907578558225507,y:.4994797086368366}},start:{frames:1,shape:{type:"rect",top:0,bottom:960,left:0,right:541},anchor:{x:0,y:0}},sign_go:{frames:1,shape:{type:"rect",top:50,bottom:51,left:100,right:100},anchor:{x:.5,y:.49504950495049505}},sign_ready:{frames:1,shape:{type:"rect",top:52,bottom:52,left:168,right:168},anchor:{x:.5,y:.5}},gauge:{frames:1,shape:{type:"rect",top:0,bottom:23,left:0,right:299},anchor:{x:0,y:0}},heart:{frames:1,shape:{type:"rect",top:0,bottom:50,left:0,right:56},anchor:{x:0,y:0}},nextBtn:{frames:1,shape:{type:"rect",top:0,bottom:54,left:0,right:92},anchor:{x:0,y:0}},end_end:{frames:1,shape:{type:"rect",top:0,bottom:961,left:0,right:541},anchor:{x:0,y:0}}},atlases:["./img/a0.json","./img/a1.json"],skelRegistry:{},fetchImage(e,i){t.add(e,e),t.load(((t,e)=>{i(e)})),t.onError(((t,i)=>{t.add(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII="),console.error("[ct.res] An image from "+i+" wasn't loaded :( Maybe refreshing the page will solve this problem…"),ct.res.texturesError++}))},fetchImage_removeError(e,i){t.add(e),t.load(((t,e)=>{i(e)}))},parseImages(){PIXI.Loader.shared.add("./img/a0.json").add("./img/a1.json").add("./img/t0.png").add("./img/t1.png").add("./img/t2.png"),PIXI.Loader.shared,PIXI.Loader.shared.load()},getTexture(t,e){if(null===e&&(e=void 0),-1===t)return void 0!==e?PIXI.Texture.EMPTY:[PIXI.Texture.EMPTY];const i=ct.res.registry[t];return void 0!==e?i.textures[e]:i.textures},makeSkeleton(t,e){const i=ct.res.skelRegistry[t],s=o.buildArmatureDisplay("Armature",i.data.name,e);return s.ctName=t,s.on(dragonBones.EventObject.SOUND_EVENT,(function(t){ct.sound.exists(t.name)?ct.sound.spawn(t.name):console.warn(`Skeleton ${s.ctName} tries to play a non-existing sound ${t.name} at animation ${s.animation.lastAnimationName}`)})),s}},PIXI.Loader.shared.onLoad.add((t=>{e.setAttribute("data-progress",t.progress),i.style.width=t.progress+"%"})),PIXI.Loader.shared.onComplete.add((()=>{for(const t in ct.res.registry){const e=ct.res.registry[t];if(e.textures=[],e.frames)for(let i=0;i<e.frames;i++){const o=`${t}@frame${i}`,s=PIXI.Loader.shared.resources[ct.res.atlases.find((t=>o in PIXI.Loader.shared.resources[t].textures))].textures[o];s.defaultAnchor=new PIXI.Point(e.anchor.x,e.anchor.y),e.textures.push(s)}else{const t=PIXI.Loader.shared.resources[e.atlas].texture;t.defaultAnchor=new PIXI.Point(e.anchor.x,e.anchor.y),e.textures.push(t)}}for(const t in ct.res.skelRegistry)ct.res.skelRegistry[t].data=PIXI.Loader.shared.resources[ct.res.skelRegistry[t].origname+"_ske.json"].data;setTimeout((()=>{ct.mouse.setupListeners(),Object.defineProperty(ct.types.Copy.prototype,"ctype",{set:function(t){this.$ctype=t},get:function(){return this.$ctype}}),Object.defineProperty(ct.types.Copy.prototype,"moveContinuous",{value:function(t,e){return this.gravity&&(this.hspeed+=this.gravity*ct.delta*Math.cos(this.gravityDir*Math.PI/-180),this.vspeed+=this.gravity*ct.delta*Math.sin(this.gravityDir*Math.PI/-180)),ct.place.moveAlong(this,this.direction,this.speed*ct.delta,t,e)}}),Object.defineProperty(ct.types.Copy.prototype,"moveContinuousByAxes",{value:function(t,e){return this.gravity&&(this.hspeed+=this.gravity*ct.delta*Math.cos(this.gravityDir*Math.PI/-180),this.vspeed+=this.gravity*ct.delta*Math.sin(this.gravityDir*Math.PI/-180)),ct.place.moveByAxes(this,this.hspeed*ct.delta,this.vspeed*ct.delta,t,e)}}),Object.defineProperty(ct.types.Tilemap.prototype,"enableCollisions",{value:function(t){ct.place.enableTilemapCollisions(this,t)}}),ct.touch.setupListeners(),ct.touch.setupMouseListeners(),PIXI.Ticker.shared.add(ct.loop),ct.rooms.forceSwitch(ct.rooms.starting)}),0)})),ct.res.parseImages()}(ct);const Copy=function(){const t=Symbol("texture");let e=0;class i extends PIXI.AnimatedSprite{constructor(i,o,s,a,n){var c;if(n=n||ct.room,i){if(!(i in ct.types.templates))throw new Error(`[ct.types] An attempt to create a copy of a non-existent type \`${i}\` detected. A typo?`);if((c=ct.types.templates[i]).texture&&"-1"!==c.texture){const e=ct.res.getTexture(c.texture);super(e),this[t]=c.texture,this.anchor.x=e[0].defaultAnchor.x,this.anchor.y=e[0].defaultAnchor.y}else super([PIXI.Texture.EMPTY]);this.type=i,this.parent=n,c.extends&&ct.u.ext(this,c.extends)}else super([PIXI.Texture.EMPTY]);return this[copyTypeSymbol]=!0,a&&(ct.u.ext(this,a),a.tx&&(this.scale.x=a.tx),a.ty&&(this.scale.y=a.ty),a.tr&&(this.rotation=a.tr)),this.position.set(o||0,s||0),this.xprev=this.xstart=this.x,this.yprev=this.ystart=this.y,this.speed=this.direction=this.gravity=this.hspeed=this.vspeed=0,this.gravityDir=270,this.depth=0,this.uid=++e,i&&(ct.u.ext(this,{type:i,depth:c.depth,onStep:c.onStep,onDraw:c.onDraw,onCreate:c.onCreate,onDestroy:c.onDestroy,shape:c.texture?ct.res.registry[c.texture].shape:{}}),a&&void 0!==a.depth&&(this.depth=a.depth),ct.types.list[i]?ct.types.list[i].push(this):ct.types.list[i]=[this],this.onBeforeCreateModifier(),ct.types.templates[i].onCreate.apply(this)),this}set tex(e){return this.textures=ct.res.getTexture(e),this[t]=e,this.shape=-1!==e?ct.res.registry[e].shape:{},this.anchor.x=this.textures[0].defaultAnchor.x,this.anchor.y=this.textures[0].defaultAnchor.y,e}get tex(){return this[t]}get speed(){return Math.hypot(this.hspeed,this.vspeed)}set speed(t){if(0!==this.speed){var e=t/this.speed;this.hspeed*=e,this.vspeed*=e}else this.hspeed=t}get direction(){return(-180*Math.atan2(this.vspeed,this.hspeed)/Math.PI+360)%360}set direction(t){var e=this.speed;return this.hspeed=e*Math.cos(t*Math.PI/-180),this.vspeed=e*Math.sin(t*Math.PI/-180),t}get rotation(){return this.transform.rotation/Math.PI*-180}set rotation(t){return this.transform.rotation=t*Math.PI/-180,t}move(){this.gravity&&(this.hspeed+=this.gravity*ct.delta*Math.cos(this.gravityDir*Math.PI/-180),this.vspeed+=this.gravity*ct.delta*Math.sin(this.gravityDir*Math.PI/-180)),this.x+=this.hspeed*ct.delta,this.y+=this.vspeed*ct.delta}addSpeed(t,e){this.hspeed+=t*Math.cos(e*Math.PI/-180),this.vspeed+=t*Math.sin(e*Math.PI/-180)}getRoom(){let t=this.parent;for(;!(t instanceof Room);)t=t.parent;return t}onBeforeCreateModifier(){}}return i}();!function(ct){const t=function(){this.$chashes=ct.place.getHashes(this);for(const t of this.$chashes)t in ct.place.grid?ct.place.grid[t].push(this):ct.place.grid[t]=[this]};ct.types={Copy:Copy,list:{BACKGROUND:[],TILEMAP:[]},templates:{},make(e,i=0,o=0,s,a){s instanceof PIXI.Container&&(a=s,s=void 0);const n=new Copy(e,i,o,s);return a?a.addChild(n):ct.room.addChild(n),ct.stack.push(n),t.apply(n),n},move(t){t.move()},addSpeed(t,e,i){t.addSpeed(e,i)},each(t){for(const e of ct.stack)e instanceof Copy&&t.apply(e,this)},with(t,e){e.apply(t,this)},exists:t=>t instanceof Copy?!t.kill:t instanceof PIXI.DisplayObject?Boolean(t.position):Boolean(t),isCopy:t=>t instanceof Copy},ct.types.copy=ct.types.make,ct.types.addSpd=ct.types.addSpeed,ct.types.templates.Ch={depth:10,texture:"en1",onStep:function(){switch(this.state){case 0:break;case 1:if(0===this.cnt)this.cnt=1,this.initialVelocity=-20,this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity;else if(this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity,this.initialVelocity>0&&0===this.currentFrame&&this.gotoAndStop(1),this.initialVelocity>3){this.referYPosition=this.y,this.timetableY=this.y,this.gravity=.3,this.setState(11);break}if(ct.room._isDragging){this.targetX=ct.touch.x,this.currentX=this.x+this.width/2;const t=this.targetX-this.currentX;if(Math.abs(t)<=8)return;t>0?this.x+=4*ct.delta:this.x-=4*ct.delta}this.y<360&&!ct.camera.follow&&(ct.camera.drift=.9,ct.camera.follow=this);break;case 10:if(0===this.cnt)this.cnt=1,ct.sound.spawn("pop"),this.gotoAndStop(0),this.initialVelocity=-15,this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity,this.jumpYPosition=this.y;else if(this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity,this.initialVelocity>0&&0===this.currentFrame&&this.gotoAndStop(1),this.initialVelocity>3){this.referYPosition=this.y,this.setState(11);break}if(ct.room._isDragging){this.targetX=ct.touch.x,this.currentX=this.x+this.width/2;const t=this.targetX-this.currentX;if(Math.abs(t)<=8)return;t>0?this.x+=4*ct.delta:this.x-=4*ct.delta}break;case 11:if(this.y>this.referYPosition+2e3)return void ct.rooms.switch("GameOver");this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity;const t=ct.place.occupied(this,this.x,this.y,"Obs");t&&("Cloud"===t.type||"Cloud_no"===t.tpe?this.setState(10):"Bubble"===t.type?(t.crash(),this.setState(10)):"Balloon"===t.type?this.setState(10):"DarkCloud"===t.type?t.crash():"Bird"===t.type?this.setState(20):"Rainbow"===t.type&&(t.kill=!0,this.setState(15)));const e=ct.place.occupied(this,this.x,this.y,"Item");if(e&&(e.itemType?(this.tex="en2",e.kill=!0,ct.room._heartGauge+=ct.room.itemHeart,ct.room._heartGauge>ct.room.MAXHEART&&(ct.room._heartGauge=ct.room.MAXHEART),ct.emitters.append(this,"Twingcle",{position:{x:0,y:0}})):(this.tex="en3",e.kill=!0),ct.u.wait(1e3).then((()=>{this.tex="en1"})).catch((t=>{}))),ct.room._isDragging){this.targetX=ct.touch.x,this.currentX=this.x+this.width/2;const t=this.targetX-this.currentX;if(Math.abs(t)<1)return;t>0?this.x+=4*ct.delta:this.x-=4*ct.delta}break;case 15:if(0===this.cnt?(this.cnt=1,console.log("무지개만남"),console.log("-------------------------무지개효과 생성"),this.heartShot=ct.emitters.append(this,"Heart_shot"),this.initialVelocity=-30,this.gravity=0):12===this.cnt&&(console.log("무지개효과 끝-----------------------------"),this.gravity=.3),this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity,this.initialVelocity>0){this.heartShot.stop(),this.setState(11);break}if(ct.room._isDragging){this.targetX=ct.touch.x,this.currentX=this.x+this.width/2;const t=this.targetX-this.currentX;if(Math.abs(t)<=8)return;t>0?this.x+=4*ct.delta:this.x-=4*ct.delta}this.cnt++;break;case 20:if(0===this.cnt&&(this.cnt=1,this.initialVelocity=-5,this.tex="en3"),this.y+=this.initialVelocity*ct.delta,this.initialVelocity+=this.gravity,this.y>this.referYPosition+2e3)return void ct.rooms.switch("GameOver");break;case 30:break;case 9:this.nextState=this.evtQ.shift(),void 0!==this.nextState&&this.setState(this.nextState)}},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0,this.evtQ=[],this.initialVelocity=-10,this.gravity=.13,this.referYPosition,this.jumpYPosition,this.stopped=!1,this.targetX=0,this.currnetX=0,this.velocity=0,this.acceleration=.1,ct.camera.followX=!1,ct.camera.followY=!0,this.timeUp=3,this.timetableY,this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)},this.addEvtQ=function(t,e){e?(this.setState(t),this.evtQ.length=0):this.evtQ.push(t)}},extends:{}},ct.types.list.Ch=[],ct.types.templates.Cloud={depth:1,texture:"cloud_1",onStep:function(){switch(this.state){case 0:0===this.cnt&&(this.cnt=1);break;case 1:if(0===this.cnt){this.cnt=1,this.setState(10,500);break}}this.y>ct.camera.y+ct.camera.height/2+400&&(this.kill=!0)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0;let t=10;ct.room._heartGauge<ct.room.MAXHEART/2&&(t=30),ct.random.chance(t)&&ct.types.copy("Item",this.x+40,this.y-77),this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)},this.crash=function(){this.setState(1)}},extends:{ctype:"Obs"}},ct.types.list.Cloud=[],ct.types.templates.Bubble={depth:1,texture:"cloud_2",onStep:function(){switch(this.state){case 0:0===this.cnt&&(this.cnt=1,this.croup="Obs");break;case 10:if(0===this.cnt){this.cnt=1,this.cgroup=null,this.tint=ct.u.hexToPixi("#0da4b1");break}10===this.cnt&&(this.kill=!0),this.cnt++}this.y>ct.camera.y+ct.camera.height/2+400&&(this.kill=!0)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0,ct.random.chance(10)&&ct.types.copy("Item",this.x+40,this.y-77),this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)},this.crash=function(){this.setState(10)}},extends:{ctype:"Obs"}},ct.types.list.Bubble=[],ct.types.templates.Balloon={depth:2,texture:"en4",onStep:function(){switch(this.state){case 0:0===this.cnt&&(this.cnt=1)}this.y>ct.camera.y+ct.camera.height/2+400&&(this.kill=!0),0===this.direction&&this.x>=screen.endX-this.width?this.direction=180:180===this.direction&&this.x<=screen.startX&&(this.direction=0),this.move()},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0,this.scale.x=this.scale.y=1.5,this.speed=3,this.direction=0,this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)}},extends:{ctype:"Obs"}},ct.types.list.Balloon=[],ct.types.templates.DarkCloud={depth:1,texture:"cloud_3",onStep:function(){switch(this.state){case 0:0===this.cnt&&(this.cnt=1);break;case 10:this.alpha-=.1,this.alpha<0&&(this.kill=!0)}this.y>ct.camera.y+ct.camera.height/2+400&&(this.kill=!0)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0,this.alpha=.8,ct.random.chance(10)&&ct.types.copy("Item",this.x+40,this.y-77),this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)},this.crash=function(){this.setState(10)}},extends:{ctype:"Obs"}},ct.types.list.DarkCloud=[],ct.types.templates.Gauge_bg={depth:50,texture:"gauge-bg",onStep:function(){},onDraw:function(){this.y=ct.camera.y-ct.camera.height/2+23},onDestroy:function(){},onCreate:function(){},extends:{}},ct.types.list.Gauge_bg=[],ct.types.templates.Item={depth:9,texture:"wo1",onStep:function(){},onDraw:function(){},onDestroy:function(){},onCreate:function(){31==ct.room._state?this.tex=ct.random.dice("song1","wo1","love1","love1","love1","love3","love1","love3","bum1","monkey"):32==ct.room._stat?this.tex=ct.random.dice("song1","song2","wo1","wo2","love3","love3","bum1","monkey"):33==ct.room._stat?this.tex=ct.random.dice("song1","song2","song3","wo1","wo2","love3","love3","love3","bum1","monkey"):34==ct.room._stat?this.tex=ct.random.dice("song1","song2","song3","wo1","wo2","wo1","wo2","bum1","monkey"):35==ct.room._stat&&(this.tex=ct.random.dice("song1","song2","song3","song4")),this.itemType=!0,"bum1"!=this.tex&&"monkey"!=this.tex||(this.itemType=!1)},extends:{ctype:"Item"}},ct.types.list.Item=[],ct.types.templates.Cartoon={depth:401,texture:"cut_0",onStep:function(){},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.setToon=function(t){switch(t){case 1:this.tex="cut_1";break;case 2:this.tex="cut_2";break;case 3:this.tex="cut_3";break;case 4:this.tex="cut_4";break;case 5:this.tex="cut_5"}},this.setTex=function(t){this.tex=t}},extends:{}},ct.types.list.Cartoon=[],ct.types.templates.Sign={depth:100,texture:"sign_ready",onStep:function(){},onDraw:function(){},onDestroy:function(){},onCreate:function(){ct.u.waitUi(900).then((()=>{this.tex="sign_go",ct.u.waitUi(700).then((()=>{this.kill=!0,ct.room.setState(30)})).catch((t=>{}))})).catch((t=>{}))},extends:{}},ct.types.list.Sign=[],ct.types.templates.Gauge={depth:101,texture:"gauge",onStep:function(){},onDraw:function(){this.y=ct.camera.y-ct.camera.height/2+26,this.maskWidth=this.MAXWIDTH*(ct.room._heartGauge/this.maxGauge),this.__mask.clear(),this.__mask.beginFill(16711680),this.__mask.drawRect(0,-50,this.maskWidth,100),this.__mask.endFill(),this.heart.x=this.x+this.maskWidth-20},onDestroy:function(){},onCreate:function(){this.isLive=!0,this.MAXWIDTH=299,this.maxGauge=ct.room._heartGauge,this.__mask=new PIXI.Graphics,this.__mask.beginFill(16711680),this.__mask.drawRect(0,-50,this.MAXWIDTH,100),this.__mask.endFill(),this.addChild(this.__mask),this.mask=this.__mask,this.heart=ct.types.copy("Heart",this.x+this.MAXWIDTH-25,this.y-25),this.decreaseGauge=function(){if(ct.room._heartGauge>0)ct.room._heartGauge-=ct.delta;else if(this.isLive)return this.isLive=!1,void ct.room.ch.setState(20)}},extends:{}},ct.types.list.Gauge=[],ct.types.templates.Heart={depth:102,texture:"heart",onStep:function(){},onDraw:function(){this.y=ct.camera.y-ct.camera.height/2+15},onDestroy:function(){},onCreate:function(){},extends:{}},ct.types.list.Heart=[],ct.types.templates.NextBtn={depth:410,texture:"nextBtn",onStep:function(){ct.actions.TOUCH.pressed&&window._ut.isBetweenPos(ct.touch,this.btn)&&this.isTouch&&(this.isTouch=!1,ct.types.list.Cartoon[0].tex="end_end",this.kill=!0)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.isTouch=!0,this.btn={x:this.x,y:this.y,w:this.width,h:this.height}},extends:{}},ct.types.list.NextBtn=[],ct.types.templates.Cloud_no={depth:1,texture:"cloud_1",onStep:function(){switch(this.state){case 0:0===this.cnt&&(this.cnt=1);break;case 1:if(0===this.cnt){this.cnt=1,this.setState(10,500);break}}this.y>ct.camera.y+ct.camera.height/2+400&&(this.kill=!0)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.state=0,this.cnt=0,this.setState=function(t,e){e?ct.u.waitUi(e).then((()=>{this.state=t,this.cnt=0})).catch((t=>{})):(this.state=t,this.cnt=0)},this.crash=function(){this.setState(1)}},extends:{ctype:"Obs"}},ct.types.list.Cloud_no=[],ct.types.templates.Text={depth:0,onStep:function(){this.blinkTimer--,this.blinkTimer<=0&&(this.blinkTimer=this.visible?18:42,this.visible=!this.visible)},onDraw:function(){},onDestroy:function(){},onCreate:function(){this.des="pc환경에서 지원하지 않습니다. 모바일로 해주세요!",this.desLabel=new PIXI.Text(this.des,ct.styles.get("warnText")),this.desLabel.anchor.x=.5,this.addChild(this.desLabel),this.blinkTimer=48},extends:{}},ct.types.list.Text=[],ct.types.beforeStep=function(){},ct.types.afterStep=function(){},ct.types.beforeDraw=function(){!1},ct.types.afterDraw=function(){if(this.transform&&this.transform._localID!==this.transform._currentLocalID||this.x!==this.xprev||this.y!==this.yprev){delete this._shape;const t=this.$chashes||[];this.$chashes=ct.place.getHashes(this);for(const e of t)-1===this.$chashes.indexOf(e)&&ct.place.grid[e].splice(ct.place.grid[e].indexOf(this),1);for(const e of this.$chashes)-1===t.indexOf(e)&&(e in ct.place.grid?ct.place.grid[e].push(this):ct.place.grid[e]=[this])}},ct.types.onDestroy=function(){if(this.$chashes)for(const t of this.$chashes)ct.place.grid[t].splice(ct.place.grid[t].indexOf(this),1)}}(ct);class Background extends PIXI.TilingSprite{constructor(t,e=0,i=0,o={}){var s=ct.camera.width,a=ct.camera.height;const n=t instanceof PIXI.Texture?t:ct.res.getTexture(t,e||0);"no-repeat"!==o.repeat&&"repeat-x"!==o.repeat||(a=n.height*(o.scaleY||1)),"no-repeat"!==o.repeat&&"repeat-y"!==o.repeat||(s=n.width*(o.scaleX||1)),super(n,s,a),ct.backgrounds.list[t]||(ct.backgrounds.list[t]=[]),ct.backgrounds.list[t].push(this),ct.types.list.BACKGROUND.push(this),ct.stack.push(this),this.anchor.x=this.anchor.y=0,this.depth=i,this.shiftX=this.shiftY=this.movementX=this.movementY=0,this.parallaxX=this.parallaxY=1,o&&ct.u.extend(this,o),this.scaleX&&(this.tileScale.x=Number(this.scaleX)),this.scaleY&&(this.tileScale.y=Number(this.scaleY)),this.reposition()}onStep(){this.shiftX+=ct.delta*this.movementX,this.shiftY+=ct.delta*this.movementY}reposition(){const t=this.isUi?{x:0,y:0,width:ct.camera.width,height:ct.camera.height}:ct.camera.getBoundingBox();"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat?(this.y=t.y,this.tilePosition.y=-this.y*this.parallaxY+this.shiftY,this.height=t.height+1):this.y=this.shiftY+t.y*(this.parallaxY-1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat?(this.x=t.x,this.tilePosition.x=-this.x*this.parallaxX+this.shiftX,this.width=t.width+1):this.x=this.shiftX+t.x*(this.parallaxX-1)}onDraw(){this.reposition()}static onCreate(){}static onDestroy(){}get isUi(){return!!this.parent&&Boolean(this.parent.isUi)}}ct.backgrounds={Background:Background,list:{},add(t,e=0,i=0,o=ct.room){if(!t)throw new Error("[ct.backgrounds] The texName argument is required.");const s=new Background(t,e,i);return o.addChild(s),s}},ct.types.Background=Background;class Tilemap extends PIXI.Container{constructor(t){if(super(),this.pixiTiles=[],t){this.depth=t.depth,this.tiles=t.tiles.map((t=>({...t}))),t.extends&&Object.assign(this,t.extends);for(let e=0,i=t.tiles.length;e<i;e++){const i=ct.res.getTexture(t.tiles[e].texture),o=new PIXI.Sprite(i[t.tiles[e].frame]);o.anchor.x=o.anchor.y=0,this.addChild(o),this.pixiTiles.push(o),o.x=t.tiles[e].x,o.y=t.tiles[e].y}}else this.tiles=[];ct.types.list.TILEMAP.push(this)}addTile(t,e,i,o=0){if(this.cached)throw new Error("[ct.tiles] Adding tiles to cached tilemaps is forbidden. Create a new tilemap, or add tiles before caching the tilemap.");const s=ct.res.getTexture(t,o),a=new PIXI.Sprite(s);return a.x=e,a.y=i,this.tiles.push({texture:t,frame:o,x:e,y:i,width:a.width,height:a.height}),this.addChild(a),this.pixiTiles.push(a),a}cache(t=1024){if(this.cached)throw new Error("[ct.tiles] Attempt to cache an already cached tilemap.");const e=this.getLocalBounds(),i=Math.ceil(e.width/t),o=Math.ceil(e.height/t);this.cells=[];for(let t=0;t<o;t++)for(let t=0;t<i;t++){const t=new PIXI.Container;this.cells.push(t)}for(let o=0,s=this.tiles.length;o<s;o++){const o=this.children[0],s=Math.floor((o.x-e.x)/t),a=Math.floor((o.y-e.y)/t);this.cells[a*i+s].addChild(o)}this.removeChildren();for(let t=0,e=this.cells.length;t<e;t++)0!==this.cells[t].children.length?(this.addChild(this.cells[t]),this.cells[t].cacheAsBitmap=!0):(this.cells.splice(t,1),t--,e--);this.cached=!0}cacheDiamond(t=1024){if(this.cached)throw new Error("[ct.tiles] Attempt to cache an already cached tilemap.");this.cells=[],this.diamondCellMap={};for(let e=0,i=this.tiles.length;e<i;e++){const e=this.children[0],[i,o]=ct.u.rotate(e.x,2*e.y,-45),s=Math.floor(i/t),a=Math.floor(o/t),n=`${s}:${a}`;if(!(n in this.diamondCellMap)){const t=new PIXI.Container;t.chunkX=s,t.chunkY=a,this.diamondCellMap[n]=t,this.cells.push(t)}this.diamondCellMap[n].addChild(e)}this.removeChildren(),this.cells.sort(((t,e)=>{const i=Math.max(t.chunkY,t.chunkX),o=Math.max(e.chunkY,e.chunkX);return i===o?e.chunkX-t.chunkX:i-o}));for(let t=0,e=this.cells.length;t<e;t++)this.addChild(this.cells[t]),this.cells[t].cacheAsBitmap=!0;this.cached=!0}}ct.types.Tilemap=Tilemap,ct.tilemaps={create(t=0){const e=new Tilemap;return e.depth=t,ct.room.addChild(e),e},addTile:(t,e,i,o,s=0)=>t.addTile(e,i,o,s),cache(t,e){t.cache(e)},cacheDiamond(t,e){t.cacheDiamond(e)}};const Camera=function(){class t extends PIXI.DisplayObject{constructor(t,e,i,o){super(),this.follow=this.rotate=!1,this.followX=this.followY=!0,this.targetX=this.x=t,this.targetY=this.y=e,this.z=500,this.width=i||1920,this.height=o||1080,this.shiftX=this.shiftY=this.interpolatedShiftX=this.interpolatedShiftY=0,this.borderX=this.borderY=null,this.drift=0,this.shake=0,this.shakeDecay=5,this.shakeX=this.shakeY=1,this.shakeFrequency=50,this.shakePhase=this.shakePhaseX=this.shakePhaseY=0,this.shakeMax=10,this.getBounds=this.getBoundingBox}get scale(){return this.transform.scale}set scale(t){"number"==typeof t&&(t={x:t,y:t}),this.transform.scale.copyFrom(t)}moveTo(t,e){this.targetX=t,this.targetY=e}teleportTo(t,e){this.targetX=this.x=t,this.targetY=this.y=e,this.shakePhase=this.shakePhaseX=this.shakePhaseY=0,this.interpolatedShiftX=this.shiftX,this.interpolatedShiftY=this.shiftY}update(t){!function(t,e){const i=e/(PIXI.Ticker.shared.maxFPS||60);t.shake-=i*t.shakeDecay,t.shake=Math.max(0,t.shake),t.shakeMax&&(t.shake=Math.min(t.shake,t.shakeMax));const o=i*t.shakeFrequency;t.shakePhase+=o,t.shakePhaseX+=o*(1+.25*Math.sin(.1489*t.shakePhase)),t.shakePhaseY+=o*(1+.25*Math.sin(.1734*t.shakePhase))}(this,t),this.follow&&this.follow.kill&&(this.follow=!1),this.follow&&"x"in this.follow&&"y"in this.follow&&function(t){const e=null===t.borderX?t.width/2:Math.min(t.borderX,t.width/2),i=null===t.borderY?t.height/2:Math.min(t.borderY,t.height/2),o=t.uiToGameCoord(e,i),s=t.uiToGameCoord(t.width-e,t.height-i);t.followX&&(t.follow.x<o[0]-t.interpolatedShiftX?t.targetX=t.follow.x-e+t.width/2:t.follow.x>s[0]-t.interpolatedShiftX&&(t.targetX=t.follow.x+e-t.width/2)),t.followY&&(t.follow.y<o[1]-t.interpolatedShiftY?t.targetY=t.follow.y-i+t.height/2:t.follow.y>s[1]-t.interpolatedShiftY&&(t.targetY=t.follow.y+i-t.height/2))}(this);const e=this.drift?Math.min(1,(1-this.drift)*t):1;var i;this.x=this.targetX*e+this.x*(1-e),this.y=this.targetY*e+this.y*(1-e),this.interpolatedShiftX=this.shiftX*e+this.interpolatedShiftX*(1-e),this.interpolatedShiftY=this.shiftY*e+this.interpolatedShiftY*(1-e),void 0!==(i=this).minX&&(i.x=Math.max(i.minX+i.width*i.scale.x*.5,i.x),i.targetX=Math.max(i.minX,i.targetX)),void 0!==i.maxX&&(i.x=Math.min(i.maxX-i.width*i.scale.x*.5,i.x),i.targetX=Math.min(i.maxX,i.targetX)),void 0!==i.minY&&(i.y=Math.max(i.minY+i.height*i.scale.y*.5,i.y),i.targetY=Math.max(i.minY,i.targetY)),void 0!==i.maxY&&(i.y=Math.min(i.maxY-i.height*i.scale.y*.5,i.y),i.targetY=Math.min(i.maxY,i.targetY)),this.x=this.x||0,this.y=this.y||0}get computedX(){const t=(Math.sin(this.shakePhaseX)+.25*Math.sin(3.1846*this.shakePhaseX))/1.25;return this.x+t*this.shake*Math.max(this.width,this.height)/100*this.shakeX+this.interpolatedShiftX}get computedY(){const t=(Math.sin(this.shakePhaseY)+.25*Math.sin(2.8948*this.shakePhaseY))/1.25;return this.y+t*this.shake*Math.max(this.width,this.height)/100*this.shakeY+this.interpolatedShiftY}get left(){return this.computedX-this.width/2*this.scale.x}get top(){return this.computedY-this.height/2*this.scale.y}get right(){return this.computedX+this.width/2*this.scale.x}get bottom(){return this.computedY+this.height/2*this.scale.y}uiToGameCoord(t,e){const i=(t-this.width/2)*this.scale.x,o=(e-this.height/2)*this.scale.y,s=ct.u.rotate(i,o,this.rotation);return[s[0]+this.computedX,s[1]+this.computedY]}gameToUiCoord(t,e){const i=t-this.computedX,o=e-this.computedY,s=ct.u.rotate(i,o,-this.rotation);return[s[0]/this.scale.x+this.width/2,s[1]/this.scale.y+this.height/2]}getTopLeftCorner(){return this.uiToGameCoord(0,0)}getTopRightCorner(){return this.uiToGameCoord(this.width,0)}getBottomLeftCorner(){return this.uiToGameCoord(0,this.height)}getBottomRightCorner(){return this.uiToGameCoord(this.width,this.height)}getBoundingBox(){const t=new PIXI.Bounds,e=this.getTopLeftCorner(),i=this.getTopRightCorner(),o=this.getBottomLeftCorner(),s=this.getBottomRightCorner();return t.addPoint(new PIXI.Point(e[0],e[1])),t.addPoint(new PIXI.Point(i[0],i[1])),t.addPoint(new PIXI.Point(o[0],o[1])),t.addPoint(new PIXI.Point(s[0],s[1])),t.getRectangle()}get rotation(){return this.transform.rotation/Math.PI*-180}set rotation(t){return this.transform.rotation=t*Math.PI/-180,t}contains(t){const e=t.getBounds(!0);return e.right>0&&e.left<this.width*this.scale.x&&e.bottom>0&&e.top<this.width*this.scale.y}realign(t){if(!t.isUi)throw new Error("[ct.camera] An attempt to realing a room that is not in UI space. The room in question is",t);const e=ct.rooms.templates[t.name].width||1,i=ct.rooms.templates[t.name].height||1;for(const o of t.children)"xstart"in o&&!o.skipRealign&&(o.x=o.xstart/e*this.width,o.y=o.ystart/i*this.height)}manageStage(){const t=this.computedX,e=this.computedY,i=1/(isNaN(this.scale.x)?1:this.scale.x),o=1/(isNaN(this.scale.y)?1:this.scale.y);for(const s of ct.stage.children)!s.isUi&&s.pivot&&(s.x=-this.width/2,s.y=-this.height/2,s.pivot.x=t,s.pivot.y=e,s.scale.x=i,s.scale.y=o,s.angle=-this.angle)}}return t}();if(ct.sound||(ct.sound={detect(t){var e=document.createElement("audio");return Boolean(e.canPlayType&&e.canPlayType(t).replace(/no/,""))},init(t,e,i){var o="";ct.sound.mp3&&e.mp3?o=e.mp3:ct.sound.ogg&&e.ogg?o=e.ogg:ct.sound.wav&&e.wav&&(o=e.wav),i=i||{};var s={src:o,direct:document.createElement("audio"),pool:[],poolSize:i.poolSize||5};return""!==o?(ct.res.soundsLoaded++,s.direct.preload=i.music?"metadata":"auto",s.direct.onerror=s.direct.onabort=function(){console.error("[ct.sound] Oh no! We couldn't load "+o+"!"),s.buggy=!0,ct.res.soundsError++,ct.res.soundsLoaded--},s.direct.src=o):(ct.res.soundsError++,s.buggy=!0,console.error("[ct.sound] We couldn't load sound named \""+t+"\" because the browser doesn't support any of proposed formats.")),ct.res.sounds[t]=s,s},spawn(t,e,i){"function"==typeof(e=e||{})&&(i=e);var o=ct.res.sounds[t];if(o.pool.length<o.poolSize){var s=document.createElement("audio");return s.src=o.src,e&&ct.u.ext(s,e),o.pool.push(s),s.addEventListener("ended",(function(t){o.pool.splice(o.pool.indexOf(s),1),i&&i(!0,t)})),s.play(),s}return i&&i(!1),!1},exists:t=>t in ct.res.sounds},ct.sound.wav=ct.sound.detect('audio/wav; codecs="1"'),ct.sound.mp3=ct.sound.detect("audio/mpeg;"),ct.sound.ogg=ct.sound.detect("audio/ogg;")),ct.sound.init("pop",{wav:!1,mp3:"./snd/a3aefdc5-ab08-44d4-9cfe-ecd7a584abb6.mp3",ogg:!1},{poolSize:1,music:!1}),ct.sound.init("fail",{wav:!1,mp3:"./snd/eadcfa08-6557-4bcb-b47e-f7945073f393.mp3",ogg:!1},{poolSize:1,music:!1}),function(){const t=Symbol("time"),e=Symbol("roomUid"),i=Symbol("timeLeftOriginal"),o=Symbol("promiseResolve"),s=Symbol("promiseReject");class a{constructor(a,n=!1,c=!1){this[e]=ct.room.uid||null,this.name=n&&n.toString(),this.isUi=c,this[t]=0,this[i]=a,this.timeLeft=this[i],this.promise=new Promise(((t,e)=>{this[o]=t,this[s]=e})),this.rejected=!1,this.done=!1,this.settled=!1,ct.timer.timers.add(this)}then(...t){return this.promise.then(...t)}catch(t){return this.promise.catch(t)}get time(){return 1e3*this[t]/ct.speed}set time(e){this[t]=e/1e3*ct.speed}update(){!0!==this.rejected&&!0!==this.done?(this[t]+=this.isUi?ct.deltaUi:ct.delta,ct.room.uid!==this[e]&&null!==this[e]&&this.reject({info:"Room switch",from:"ct.timer"}),0!==this.timeLeft&&(this.timeLeft=this[i]-this.time,this.timeLeft<=0&&this.resolve())):this.remove()}resolve(){this.settled||(this.done=!0,this.settled=!0,this[o](),this.remove())}reject(t){this.settled||(this.rejected=!0,this.settled=!0,this[s](t),this.remove())}remove(){ct.timer.timers.delete(this)}}window.CtTimer=a,ct.timer={timers:new Set,counter:0,add:(t,e=!1)=>new a(t,e,!1),addUi:(t,e=!1)=>new a(t,e,!0),updateTimers(){for(const t of this.timers)t.update()}}}(),document.fonts)for(const t of document.fonts)t.load();
})();